---
title: Games101 5.Rasterization 1 (Triangles)
---

光栅化是关于怎么把我们前面的-1~1 的三次方的立方体画到屏幕上的过程

## Perspective Projection

在正交投影中如何定义视野的长方体呢？
![Alt text](image.png)
其实就是用 l、r、b、t、n、f 这六个参数来定义这个长方体

然后透视投影我们是把 frustum 变成一个长方体，这个 frustum 怎么定义呢？

- 首先用 aspect ratio 来定义宽高比
- 另外用 fovY（field of view）来定义能看到的角度范围，上下中点夹角的角度。
  - 广角相机的广角其实就是指的这个角度比较大
  - 如果这个角度比较小，透视投影就越不明显，就越像正交投影。
  - 另外，像大家打游戏会涉及到水平的可视角度，这个水平的可视角度和垂直的可视角度是可以相互转化的。

![Alt text](image-1.png)

## What's After MVP?

![Alt text](image-2.png)

- MVP 过后，我们得到的是一个-1~1 的三次方的立方体，然后我们要把这个立方体画到屏幕上。

## Canonical Cube to Screen

- 在图形学上，我们把屏幕抽象成一个二维的数组，数组中的每一个元素是一个像素。像常见的屏幕分辨率 1920x1080，就是 1920 个像素宽，1080 个像素高。

![Alt text](image-3.png)

- 光栅化（rasterization）其中的 raster 本来是德语中的一个词，表示屏幕，然后把这个名词变成动词，就是把东西画在屏幕上的过程。

- 像素这个名字本来是叫做 picture element，然后缩写成 pixel，一个像素代表一个固定的颜色，可以是 0-255 的灰度，也可以是 RGB 三个值，每个值是 0-255。

什么叫屏幕空间呢？
![Alt text](image-5.png)

- 其实就是在屏幕中建立一个坐标系，可能会有各种不同的定义，我们这里把左下角定义为原点，向右是 x，向上是 y。
- 一个像素的中心在哪里呢？其实是在 x 加 0.5 和 y 加 0.5 上。

然后我们需要把之前的-1~1 的三次方的立方体映射到屏幕上
![Alt text](image-4.png)

- 关于 z 值的处理，暂时先不管，后面会讲到。
- x 跟 y 的转换就很简单了

这里相当于我们获取了场景的一张虚拟的照片，但它还是空间中描述的一堆三角形，我们要真正的把它变为像素表示的图，也就是光栅化的过程。
![Alt text](image-6.png)

## Drawing Machines

在说光栅化之前，我们来看一些绘制的机器：

![Alt text](image-7.png)

![Alt text](image-8.png)

## Different Raster Displays

以及各种光栅化的显示设备：

示波器：
![Alt text](image-9.png)
早期的很多电脑显示器就是这样
![Alt text](image-10.png)
可以形成各种不同的曲线
示波器本身是一个成像设备，和早期的显示器的成像原理一样，下面这个叫做阴极射线管：
![Alt text](image-11.png)

左边的 Electron Emitter 产生很多的电子，然后穿过显示设备，发生偏转，偏在不同的位置上。这个过程进行的足够快，就可以形成一个完整的图像。这个是非常早期的屏幕，叫做 crt 屏幕。这个屏幕非常伤眼睛。

![Alt text](image-12.png)

早期的电视或者电脑显示器，都是通过扫描的方式，把一个一个的点打在屏幕上，，从屏幕左上角开始，画一道又一道的线，不断的换行。

然后有一个技术叫做隔行扫描，就是画一半，然后再画另一半，这样可以减少一半的工作量，因为人眼有视觉暂留的效应，所以也可以看到完整的画面。这个技术直到现在还在一些视频压缩里面起到一些作用。

不过这个隔行扫描会造成画面撕裂，尤其是高速运动的画面，就会有这种鬼影的现象。


给定一个显示器要怎么知道到底要显示什么呢？

### 00:32:35,30

![00-32-35](tmp/00-32-35.jpg)

其实来说这个这个我们就只需要知道它们的原理就可以了

什么呢

就是说呃给我一个显示器

我怎么知道它要显示什么呢对吧

然后呢这个很简单

就是说我的显示器呃

我自然是这个啊

通过这个这

个这个呃显卡或者说这个嗯通用来说

就是说呃这个内存里面的一块区域

然后显卡里的内存我们管它叫显存啊

所谓这个 memory

然后呢就是说内存中间的一块区域

我们把这块区域给映射到这个屏幕上

这里就是我们认为现在这个屏幕的显示方式嗯

这个之后呢咱们还会给大家讲

就是说我们可以生成这个不同的这个呃

这个图像存在这个显存中的不同区域

然后我们可以告诉显示器

我们让了让它显示呃这个到底是哪一幅图

然后这里这个之后会这个这个多说一些

总之呢这里

这个大家明白这个显示的图像其实就是内存中的一块区域就好了

那么这里再给大家多补充一下大家这个左边这块

如果大家这个小时候

这个这个这个这个打过这个这个这个所谓的红白机哈

然后他应该接触过这个游戏

然后国内俗称叫小蜜蜂

但其实它有一个这个这个这个真名的

他叫 space invaders

叫太空侵略者啊

这里给大家这个简单给大家这个这个补充一下这块知识

ok 然后呢呃那咱们刚才既然提到说这通用的显示设备

### 00:33:58,76

![00-33-58](tmp/00-33-58.jpg)

那现在大家都在什么样的一个设备上显示呢

那现在的

主要显示设备就被称作平板显示设备啊

在这里主要是 lcd lcd 是什么

马上就给大家说

然后大家可以看到有两个这个呃两个这个不同的例子哈

一个是计算器对吧

大家可以看到计算器是一个超级低分辨率的这个这个 lcd 的显示器

然后大家可以看到一个一个的格子

然后呢手机大家可以看到底下这是一个非常高分辨率的显示器

以及呢到了现在的这个发展

然后呃人们发发明了一些这个这个非常非常高分辨率的显示设备

高到什么地步呢

高到这个屏幕

的分辨率已经超出了人的视网膜的分辨率

这种屏幕我们就管它叫做视网膜屏幕对吧

然后就是这么一个情况

然后呢大家可以看到不只是这个 lcd

更进一步的什么 l o l e d 啊

各种各样不同的这些显示设备

那咱们就不再多说

给大家着重说一下这个 l c d 所谓 lcd 是什么呢

### 00:34:59,50

![00-34-59](tmp/00-34-59.jpg)

就是我们管它叫液晶显示器对吧

液晶显示器是什么意思

顾名思义

它就是利用液晶的原理

然后来控制一个像素

它到底显示什么

然后大家可以从右边的示意图可以看到这个液晶

它

会通过自己的不同排布影响光的极化

也就是说光的偏振方向大家可以看到

其实这个这个呃这个液晶显示器的结构啊

一个像素它这个有两个不同的光栅

大家可以看到左边和右边呃

这个相当于有两个光栅以不同的方向进行排布

这个我相信大家在物理上都学过对吧

就相当于这个光它其实是有波动性的

然后这个光经过一个光栅

也就是说只会留下这个光在这一个方向

在光栅所规定的方向上

这个震动的这么一这么一些能量好吧

也就是说通过了光栅之后

光的振动方向

就和这个光栅的振动方向一致

那么大家想象一下

比如说先看右下方这幅图

这个光先通过了这个呃

右边这个光栅

这个它自然是这个竖直分布的

所以这个光只能变成竖直的震动

然后光又想试图通过左边这一面

它是这个水平震动

那通过完了之后就没了对吧

就是这个就是说你只有竖直的光通过这个水平方向

那可不是变得什么也没有了吗

那么液晶显示的原理就是相当于通过液晶的这个扭曲

然后把这个光的这个这个这个振动方向渐渐的给调过来

大家可以看到右上方

就是说这个液晶显示这个这个光原本是竖直的

然后通过这个光栅之后

它被扭成这个呃

不不是通过这个光栅

他通过这这个右边这个光栅之后仍然是竖直的

然后呢经过这个液晶的扭曲之后

把它给扭成了这个水平的

然后它就可以从水平的光栅出去了

这就是为什么你可以看到这么一个像素啊

它就是这么一个原理啊

然后这个当然得到一个非常这个呃广泛的应用

然后这块呢当然要想理解的话

得需要这个呃呃这个大学物理是稍微知道一些这个光学方面的知识

当然不难

啊就是说得需要知道一些这个光的波动性

那么呃这里大概就说到这里好吗

这是着重给大家介绍一下这么不同的种类

### 00:37:06,26

![00-37-06](tmp/00-37-06.jpg)

那么我们刚才提到这个呃 lcd 对吧

液晶显示

那还有一种我们广泛使用的东西

这个显示设备叫 l e d l e d 呢

其实它这个缩写这个就完全不一样了

叫什么呢

叫 light in meeting dialed

然后这意思就是发光二极管的意思

然后这个发光二极管很好理解

要么发光

要么不发光

大家可以看到这这个这个图啊

这个图上面这个是一块板

然后这个板呢是有各种各样不同的

这个呃

一个阵列的这么一个发光二极管构成

然后有一些可以发出这个呃

这个蓝色有些可以发出红色不同的颜色

这个当然是之前预定预定义好的好吧

这就是这个 l e d 这个显示器呃

或者显示设备啊

这些呃简单跟大家说一下好

### 00:37:52,83

![00-37-52](tmp/00-37-52.jpg)

然后还有一种这个显示设备

然后如果大家这个买过一些什么电子墨水瓶对吧

如果买过亚马逊的 kindle

那家就会知道啊

有一种显示设备是这么一个原理

就是相当于它有这个这个这个黑的有白的啊

这个不同这个这个这个墨水

然后呢经过这个给不同的这

个这个通电的这个电压啊

或者是模式啊

不同的情况它可以发生翻转

就是这个黑的在上面还是白的在上面哎

这样的话你就可以通过控制这些不同的像素

它到底黑的还是白的在上面

然后控制它这个到底你看得见看不见字

这就是这个这个电子墨水屏的原理对吧

然后当然它有一个严重的问题

这个问题是什么呢

就是说这个这个 um 叫什么呢

就是说呃它的刷新率很低

也就是说你要想改变一次

他这个嗯就是每一个像素它的黑色和白色的朝向

他要花一定的时间

而且是一个

肉眼可见的时间

这就是为什么大家要是有 kindle 的话

就是说大家会发现翻页非常的慢对吧

他得这个刷新一遍

然后呢用它看动画更是不可能

就是因为他有这么一个问题

当然它的好处就是看起来非常自然对吧好

那这个呃这就是一些简单的这个成像设备

### 00:39:04,0

![00-39-04](tmp/00-39-04.jpg)

那咱们现在回到这个呃这个课题上来对吧

怎么样在这些成像设备上面画东西

然后另外大家还记得咱们咱们这个还是假设这个屏幕上呃

是由各种各样不同的像素构成的

每一个像素是一个这个呃内部颜色不会发生变化的

小方块儿好

那么从这里开始嗯

### 00:39:24,86

![00-39-24](tmp/00-39-24.jpg)

我们已经提到说

怎么把把这个一系列的这个三维空间中的这个呃多边形也好

或者多边形的顶点也好

然后我们把它给这个变换到屏幕空间上面去

下面一步就是把多边形实际上拆成不同的像素对吧

光栅化的过程

### 00:39:40,43

![00-39-40](tmp/00-39-40.jpg)

那么我们既然提到多边形

刚才大家看到这个老虎啊是一个就靠这个不同的四边形组成的

那么咱们现在看到的这么一个例子是靠这个三角形组成的

然后嗯这里呃就是说呃三角形刚才可以用来表示这个这个三维空间中

### 00:39:54,30

![00-39-54](tmp/00-39-54.jpg)

这样一个

一个这个不同的呃不同的命令对吧

然后这个三角形同样也可以表示在二维空间中不同的图形

比如说像这里大家可以看到呃这么一个复杂的图形

它其实也是有很多的不同的三角形构成的对吧

也就是说三角形啊它表示能力其实很强的

这也就是说我们为什么认为三角形

### 00:40:14,70

![00-40-14](tmp/00-40-14.jpg)

它这个这个呃会在这个图形学中得到广泛应用

因为它有很多不错的性质

比如说呢这个三角形是最最基础的多边形

很简单

这个这个没有比这个三角形更这个边更少的多边形了

否则就退化成线段了

对

不对

然后呢任何其他不同的多边形我都可以把它拆成这个三角形

没问题

那也就是说呃这个这是一个不错的性质

就是相当于三角形

算是所有多边形中的基础对吧

然后呢三角形还有很多这个独特的一些性质

就是说嗯三角形内部只要我们给定个三角形三个点

那我们连成一个三角形

它一定得是平面的

所以说如果大家想象一个四边形

一个四边形

如果我沿着它的某一个对角线

我这么一折好了

那这个四边形就不再是平面的

但三角形不可能

除非你把它折成两个三角形对

吧然后就是说呃三角形内部一定是平面的

然后呢这个三角形的内外这个定义是非常清晰的

就是说如果涉及到多边形

多边形里面有洞怎么办

比如说像这个多边形

如果它不是凸多边形怎么办

就会有各种各样神奇的问题

但三角形不存在

三角形的内部外部定义的非常清楚

并且咱们可以通过这个这个三角形的啊不向量的叉积来定义一个点

是不是这个呃是不是在三角形内对吧

做这样的判断

然后咱们这节课很快还需要用到这个知识

### 00:41:36,30

![00-41-36](tmp/00-41-36.jpg)

然后呢这个三角形还有一些好的性质

比如说我只要定义三角形三个顶点

它们不同的属性

那么在这个形成的三角形内

我是可以做一个渐变的

这个就是把三角形内任何一个点的这个属性都给猜出来

就根据它这个三角形上和里面任何一个点

和这个三角形三个顶点的位置关系

我可以得到一个逐渐的变化

从从这个呃三角形的一个顶点变成另外这个不同的顶点

这就是说它们之间的属性在三角形内部如何差值

这就是我们之后要提到的这个嗯呃这个这个重心坐标的差值方法好吧

这个之后会说就是三角形是

### 00:42:17,10

![00-42-17](tmp/00-42-17.jpg)

有很大的优势的

那么咱们现在就盯着三角形来看

那么我们既然知道空间中不管什么三角形啊

xyz 什么

经过一系列变换之后对吧

现在在屏幕坐标我只看它的 x 和 y

那么呃我就会找到哦

这三角形和三个顶点在屏幕上都是什么位置

比如说像现在看大家看到了左边这幅图

然后是个三角形

三个顶点我都可以把它写出来

然后这个这个当然这是随意的

这个写一写这个坐标

这里认为大家可以看到

其实这里的这个坐标起点在左上角

所以这并不是我们定义的屏幕空间啊

但是没

有关系就是说我们不管怎么样

我们经过了这个 mvp 变换之后

再经过视口变换

我们就可以拿到每一个顶点在这个屏幕空间下的坐标

那么我们现在就是要把这个三角形给变成这个真正的这个

这个像素对吧

大家知道这个一个像素了

它是这个呃内部它是不可能有颜色变化的

那也就是说如果大家看这个像素对吧

这个像素现在正好被三角形盖住了大概一半的位置

那那到底咱们这个应该怎么算对吧

就是说它到底是亮还是不亮呢

然后三角形内部呢这些点这些像素自然应该

是比如说这个像素应该是全红的对吧

那像这些判断我们应当如何去判断

那这就是我们要下一步要做的事情

也就是光栅化中最重要的一个概念

也就是判断一个像素和三角形的位置关系呃

更确切来说我们考虑这个像素的中心点与这个三角形的位置关系好

### 00:43:45,40

![00-43-45](tmp/00-43-45.jpg)

那么这里呢给大家介绍这个一个最简单的做法来做这个光栅化

怎么做呢

就是说我们这个呃通过采样的方法

那采样式是什么什么概念对吧

### 00:43:57,23

![00-43-57](tmp/00-43-57.jpg)

所谓采样呢就是说给你一个函数

它是连续的

然后我在不同的地方我去问啊

这个函数的值是多少啊

这个就是采样很简单嘛对吧

然后比如说我们说呃有一个函数 fx 等于 sin x

然后我给他这个 x 等于一

x 等于二

x 等于三

一直等于 x 等于 100 啊

这些对应的 fx 都是多少

或者 sin x 都是多少对吧

很简单的这个理解

也就是说采样其实就是把一个这个函数给离散化的过程

没问题

这就是它相当于是一个呃稍微正规一点的定义

那么我们可以看这么一个这个这个代码

这正是我刚才说的对吧

给你个函数 f x

你给它不同的 x 求出不同的这个这个函数值 fx 这

就是采样

### 00:44:44,73

![00-44-44](tmp/00-44-44.jpg)

然后呢采样是一个非常非常重要的概念

在图形学里面

这个我们会涉及到各种不同的采样

咱们这里说的采样是指这个利用这个呃像素的中心

对屏幕空间进行一个采样

然后嗯大家可以想象

比如说屏幕空间咱们定义是零到 with 乘以零到 height 对吧

这么一整个区域

那么我们用像素中心进行进行采样

也就相当于是我们要算出这个呃这个我们需要的某一个函数

定义在屏幕空间上的某某某一个函数

在不同的像素中心它的值是多少对吧

然后呢我们之后还会提到说我们

还会采样

比如时间

然后位置

然后函数的这个这个这个这个呃怎么说呢

就是物体的这个表面的反射的这个性质

各种各样的东西都可以采样

三维空间也是

比如说大家可以看到医学中涉及到什么 c 啊

或者说这个什么呃这个呃核磁共振成像啊

各种各样得出来的这些这些成像的结果

其实成像出来的结果是三维的

然后就是说我们知道你这个这个病人的体内任何一个位置

然后它的这个比如说这个组织的密度是多少

对可以得到这些信息

那这个我们要把它显示出来

同样涉

及到采样

所以这是采样的重要性好吧

### 00:45:55,90

![00-45-55](tmp/00-45-55.jpg)

然后呢那我们这里回到我们要做的这个工作上来看

那我们要采用什么呢

我们要采样的就是说呃给你一个三角形

然后我要在这个像素的中心

### 00:46:05,86

![00-46-05](tmp/00-46-05.jpg)

然后来判断是否这个嗯这个像素的中心在三角形内啊

这是也是一个函数对吧

如果我们可以定义一个函数

这个函数什么呢

我们把这个函数定义成这个 inside 的这么一个函数

### 00:46:21,13

![00-46-21](tmp/00-46-21.jpg)

这个函数什么意思啊

也就是说给你一个三角形

给你屏幕空间中的任何一个点的坐标 x 和 y

然后我就要知道说这个点是不

是在三角形内

它当然是一个函数

没问题

大家可以看到对吧

给定任何一个三角形 try 或者是 t 啊

没关系

然后给你任何一个坐标

这个坐标不一定是整数

这个坐标可以是任何一个实数

那给你任何一个 xy

你你肯定可以得到诶

这个这个点要么在三角形里

要么不在那

根据它在三角形里

或者是不在

我们定义这个函数是一或者零

那咱们回到刚才的采样

### 00:46:55,70

![00-46-55](tmp/00-46-55.jpg)

这个我们这里在采样什么呢

我们就是在采样在屏幕空间中定义的这么一个 inside 的这么一个函数

就是在这个不同的这个像素的中

心我们要确定这个函数的值到底是一还是零

简单吧

就是说我们要做这么一个事情

然后

### 00:47:15,63

![00-47-15](tmp/00-47-15.jpg)

然后呢就是说我们如何去进行这么一个采样对吧

很简单

这个还是还是沿用之前我们的这么一个采样的这么一个呃

这个代码上面的一个定义对吧

那只不过这里我们把它给变成这个二维的形式

什么意思呢

大家可以看到两个 for 循环做了什么事情呢

就是相当于是我把整个屏幕上所有的像素都考虑一遍对吧

所有的像素 x y

那么这就回到我们一开始的这个定义上来了

那每一个像素它的坐标是整形的 x 和 y

那么它实际上它的中心在哪呢

它的中心在 x 加 0.5 和 y 加 0.5 上对吧

然后我们就要判断这个 x 加 0.5 和 y 加 0.5 是不是在三角形里

所以这个判断我们就通过这么一个函数来表示 inside 这个 triangle

然后这个他们对应的这个实际上它的这个像素对应的中心对吧

如果他在那得到的结果是一

如果不在得到结果是零

就相当于让这个像素 xy 它的值要么等于零

要么等于一啊

当然之后我们可以给它不同的颜色

那在这里就是一个最最最最简单的通过采样的方法来进行

这个光栅化的过程对吧

那么嗯这里就是这个这个呃采样的这么一个呃

在这里光栅栅化的过程中一个最重要的应用好吧

### 00:48:44,40

![00-48-44](tmp/00-48-44.jpg)

然后呢那这里就是一个嗯怎么说呢

就是说呃一个简单的回顾吧

就相当于是我们之前定义这个像素

它原本是这个呃 index 整整形的这个 index

然后它其实它的中心是在 x 加 0.5 和 y 加 0.5 上的对吧

然后嗯现在在这个做工商化这个过程中

### 00:49:02,93

![00-49-02](tmp/00-49-02.jpg)

咱们这个已经提到说我们可以定义一个函数

这个函数表示了说这个 x 和 y 这个点是不是在三角形内

那么当然重中之重就是说我们如何判断这个点是否在三角形内对吧

那刚才这个呃采样的过程有了

那么现在我们考虑到这么一个这个细节的这么一个一个函数里面

这个函数具体在咱们的图形学中应该怎么样去实现

那其实这个问题咱们之前在这个呃前面提到这个向量的这个呃

差机这块我们已经提到了对吧

然后如果大家还有这个概念的话

### 00:49:39,36

![00-49-39](tmp/00-49-39.jpg)

大家可以看这个三角形啊

这里啊我们有一个三角形 p0 p1 p2

然后这是三个顶点

然后我们要判断这个点 q 是不是在三角形内

那怎么办呢

我们做叉积

比如说现在大家可以看这条这个这个边 p1 p2

### 00:49:53,70

![00-49-53](tmp/00-49-53.jpg)

如果说我们可以建立一个向量

从 p 一到 p2 对吧

然后我们去插成这个向量

p1 q 也就是相当于是我们这个这个嗯 p1 p2 插成 p1 q

可以告诉我们这个 q 点在 p1 p2 的左侧还是右侧嗯

比如说像这里

咱们这个这个插值应用一下又有什么病则对吧

我们可以得到 p 一差成 p2 呃

错 p1 p2 插成 p1 q 得到了这个向量是朝外的

朝屏幕外面的对吧

然后也就是说会得到一个 z 的值是正的这么一个结果

也就是告诉我们 q 在 p1 p2 的左侧

然后那同样的道理我们可以判断呃在 p0 p 一对吧

### 00:50:34,96

![00-50-34](tmp/00-50-34.jpg)

这个这个 q 点在 p0 p 一的哪里呢

在这里看啊

应该用 p0 p 一差成 p0 q

那么得到的结果仍然是这个呃 q 点在这个 p0 p 一的左侧

只不过呢如果我们判断这个呃这个 q 点在 p2 p0 的哪个方向诶

咱们就会发现不对

那这个 p2 p0 差成 p2 q

我们得到的结果是这个这个向里的一个向量对吧

然后这就说明秀点在 p2 p0 的这个右侧

然后这就说明这个 q 点不在三角形内

否则的话这个这个 q.一定是在 p0 p1 p1 p2 p2 p0

它的这个呃在这个三三个不同的这个这个这个向量呃

这个的左侧对吧

然后同样道理

如果你这个这个三角形呢是这个顺时针安排的这个嗯

这个顶点的顺序就是说大家比如说把 p0

把 p 一和 p2 互换一下位置

那这样的话你就会发现你的这个三个这个在左还是在右的测试

如果它都是说明这个 q 点在三条这个呃向量的右侧

然后我们才能说明这个 q 点在三角形内对吧

然后就是说嗯

这这就是我们之前这个这个说的这个向量叉积的这么一个定义

也就是说我们总结一下啊

考虑一个三角形

把它安排成某种顺序

比如 a b c 或者 p0 p1 p2

然后咱们不断地重复它

就是 a b c a b c a b c

这样这样顺序就不会错

我们就会找到 ab b c

然后 c a 而不是 ac 对吧

按照这么一个循环的这么一个顺序去对这个判断

这个差乘得到的结果要么全是这个 z 是正的

要么全是 z 是负的

只有在这两种情况下才会判定 q 在三角形呃

这个这个呃 p0 p1 p2 里面对吧

所以说啊那行

那咱们现在就可以知道这个函数应该怎么样写出来了对吧

插件的这个这个呃公式我们也知道

然后现在咱们这个就已经可以判断任何一个点呃

它的这个给定一个坐标 x 和 y 我们都知道是否在三角形内

那么在结合咱们之前所说的这这么一个采样这么一个方法

我们就可以知道这个呃这个每一个像素是否应该被填上一个数字了

### 00:52:48,26

![00-52-48](tmp/00-52-48.jpg)

那么这里有同学会问这么一个问题啊

就是说呃这个如果有一点

但是正好碰巧他在三角形的边界上

这可怎么办对吧

然后像同行学里面啊

我们这个这个经常会遇到这样的问题

但通常对于这样的问题

我们要么不做处理

要么特殊处理

那么在这里简单跟大家说一下

比如说在在咱们这门课上

咱们不做处理

也就是说这个点到底算是在这个

比如说大家现在看到这幅图啊

这个点到底在三角形一还是三角形二上

呃

这个这个这个这个或者说两者都在对吧

然后这个只要自己定义一个标准

自己把这个这个说通就可以了

就是说如果我认为这个点只要在某一条边上

然后他就就在三角形内

那么得到的结果就是记在一又在二上好吧

然后如果你认为在边界上不算

那也没有关系啊

然后就是说呃这是自己定义的

当然在一些这个图形学的这个 api 上

比如说像 open gl 和这个 direct x

他们有着一个非常非常严格的规定

比如说他们认为上边和左边

这一定是这个呃

如果有点落在这个三角形上边和左边的话

然后这呃这两个点这个点都认为在三角形内

然后如果落在右边和下边的话都不算

那当然这个规矩相对复杂一些

但是也没有必要这个这个特别去掌握它

大家只要知道这是一个大家这个这个要么自己规定

要么不严格的处理的事情好吧

然后这是这个事情

### 00:54:16,56

![00-54-16](tmp/00-54-16.jpg)

那么我们刚才提到这么一个

这个通过采样来进行光栅化的这么一个一个过程

嗯那么呃大家在想啊

这个刚才我们写了一个二重的循环

x 从零到最大

然后从呃 y 从零到最大

也就相当于是我这个考虑一个三角形的光栅化的时候

我就要把所有的像素都给走一遍

是不是没必要对吧

这里这里就是说一个三角形

它其实只能覆盖一个相对较小的区域

比如说大家可以看到这里一个蓝色的这么一个区域对吧

那我说嗯左边至第一列啊

这么一些像素

它根本就不在这个蓝色的这个区域里

那它更不可能碰到这个三角形

所以我对于这些像素根本就不用看这个三角形

根本不可能填充到这些像素上

没错吧

那么对于蓝色的这么一个区域

跟这个这个更那个的说嗯

就是更严格意义上来说

因为它是这个这个水平的和竖直的这么一个边把它围成的好吧

那比如说大家知道这个三角形

咱们把它给变成这个呃

在这个屏幕左右屏幕空间的坐标下

这个 p0 p1 p2

我们都知道它的坐标 x y 对吧

然后所有的 x 我都可以取最小

也可以取最大

然后所有的 y 这三个点啊

所有的 y 都取最小和最大

那么自然就可以得到这么一个这个这个这个方形的这么一个区域对吧

然后呢这个区域

然后如果说我这个像素这本来就不在这个区域里面

那我自然就没有必要去做这个光栅化对吧

因为这个三角形一定不可能覆盖到它

然后只有这个这个区域内的这些像素

我们才需要做刚才的循环

很简单

就是 for x 等于这个这个呃 x me

然后呢让它一直循环到 x max

然后 y 也是同样这么操作就好了

就不用这个所有的 x 都要从零到 with

这个整个屏幕上所有的点都这个走一遍对吧

所以说这里呢这个这个 bounding box

其实它还有名字叫 ais aligned bounding box

然后我们平常会缩写成 aa bb

就是这么个道理

之后还会给大家说好吧

然后就是说这个呃

### 00:56:36,56

![00-56-36](tmp/00-56-36.jpg)

比如说大家看这里

就是说我可以对这个三角形所覆盖的区域啊

我每一行都找它的对应的这个最左和最右对

这样的话我连一个像素都不会多考虑对吧

当然这个事情说是容易

但做起来其实不太容易的

而且是这样啊

那这么一个三角形呃

或者说这么一个方法吧

这么一个方法适用于光栅化什么样的三角形呢

呃那那这个我我猜大家可以这个这个想不出来对吧

什么时候一个三角形其实没覆盖多少像素

它覆盖了不少像素呢

那自然是这个三角形挺窄长的

然后又是旋转过来

就是旋转 45 度

这样这样正好倒霉

那就是说对于这种情况来说

挺适合用咱们现在画的这么一种方法

所以说呢呃这个就是说针对不同的情况

那自然有不同的处理方法好吧

然后呢啊所以说这个呃这就是我们提到的这么一个这个光栅化的一点

### 00:57:49,30

![00-57-49](tmp/00-57-49.jpg)

点

这个这个简单做法对吧

通过采样这个呃 inside 的这么一个函数

然后我们得到了光栅化呃的方法

其实说白了就是每个像素就是每个可能的像素吧

检测一下是不是在三角形内

那么这个理论是非常简单的

那咱们现在提到提一下这个实际的这个这个屏幕的光栅化

或者说我们看一眼这个这个实际的屏幕应该是什么样的好吧

比如说这里这里拍了两个手机的屏幕

### 00:58:16,23

![00-58-16](tmp/00-58-16.jpg)

它们在显示同样的一个画面啊

然后大家可以看到这一个是 iphone

一个是三星的 galaxy

然后嗯这里呢大家会发现不对

那就是这个老师讲错了对吧

一个像素它根本就不是这个这个一个这个小的一块呃

比如说左边这个 iphone 上面

大家可以看到一个像素其实是由三个不同的条对吧

呃红绿蓝就是 rgb 3 个不同的条放在一块变成一个像素

没错

这是像素的这个这个内部的一些这个结构

然后呢大家可以看看右边更有意思了

右边这个这个是这个红绿蓝仍然是三个颜色

然后这三个颜色它形成了某一种这个图案对吧

这种图案还可以给大家说一下

b a y e r 啊

然后呢这里像素根本就不是一个方块的对吧

你很难找一个方块把它给这个圈起来

说这就是一个像素对吧

然后呢另外还有一个特点

这里好吧

这个这个正好有时间给大家这个多说一下啊

这里大家可以其实可以看到一个一个现象

如果大家仔细注意的话

这个呃绿色的点其实要比这个红色和蓝色的都要多

这个要怎么看呢

就是如果大家盯着这个这个某一块区域看

其实不容易看清

那我给大家提供一个方法

要这么看

比如说大家就只看红颜色的点

大家可以大概有一个这个红颜色的点

它的这个密度是多少

我说的是这个三星 galaxy 啊

右边这个

然后就是说大家可以看到红颜色的点

它大概有一个什么密度

它和蓝颜色的点

它的密度基本上是一样的

对不对

然后呢

但这个如果大家看这个绿颜色的点

就只看绿颜色的点

大家很明显会感觉到啊这些绿色的点它的密度要比红色和蓝色都要高

也就是说实际上啊这个这个嗯对于这种屏幕来说

或者对于这个 bar pattern 来说

他用了更多的绿色的点

然后这是怎么回事呢

这是因为啊人眼它这个这个本质上来看

他对这个绿色这个颜色最为敏感

所以说在绿色上多一些这个这个不同的这个这个像素是有好处的

哎啊稍等啊

就是说这个同样道理在这个相机里面

其实有很多相机也是这么设计的

就是相当于这个不同的感光元件

比如涉及到绿色的感光元件

它们就放的多一些

就用通过这么一种这个 bar pattern 的形式

这这这么一种这个就就是把这些这个原件以不同的密度组织起来

这样的话在绿色上会有更多的感光元件

也就是说可以得到这个在绿色上更好的这个还原

从而人眼看上去会更舒服

就是这么一个道理

好吧好

这是这么一个呃意思

当然在这个其他成像设备

### 01:01:05,20

![01-01-05](tmp/01-01-05.jpg)

比如说彩色打印机上大家会看到一个更复杂的这样一个一个这个图案

大家可以看到右边这是一个左边这幅图放大了一点的结果

大家可以看到这些图案这个分布非常非常奇怪的对吧

这个斜着的这样这样一个蓝色的分布

以及说还有这样的红色的分布

然后还有黄颜色的

就是说在打印的过程中

大家这个有时候会更多关注一些

比如说如何去最省这个这个末对吧

以及其实我们之后会在颜色这一章专门给大家说

这个是一个打印来说

这是一个检测系统

所谓检测系统就是说你往上加的能量越多

不加加的颜色越多

他最后得到的结果越黑

然后我们平常提到的这个这个屏幕他们是一个 rgb 呃

这个他们正好是反过来的

就相当于是这个 rgb 的值越高

表示它越亮越靠近白色

对吧啊

这里这个简单说一下

### 01:01:58,93

![01-01-58](tmp/01-01-58.jpg)

然后呢呃再回到咱们这门课上

咱们这门课仍然认为这个呃屏幕上面每一个像素

好吧

这里是没有问题的

这就是简单给大家说一下好

### 01:02:14,96

![01-02-14](tmp/01-02-14.jpg)

然后那咱们今天的课就差不多了

咱们咱们在这一课的最后看一个问题对吧

大家看到哈

我对于屏幕中间这些不同的像素的中心点

然后我都可以判断啊

这个是否在三角形内那行

那我自然要知道好

它在三角形内

咱们就把它填成这个三角形对应的颜色

那咱们又知道像素是一个小方块

所以如果说这个大家现在看到的这幅图是屏幕的中心点

它都点成了这个对应的

要么是红色表示三角形内

要么是这个白色表示三角形 y 那对应在不同的像素上是什么呢

### 01:02:54,83

![01-02-54](tmp/01-02-54.jpg)

大家其实看到的应该是这么一幅图

对不对

所以一个三角形会会这个变成这么一幅图

唉这个大家就发现不太对对吧

那么大家想要什么呢

大家想要的是这个对吧

想要的是这个三角形

可是大家得到的是什么呢

得到的是这么一个形状

### 01:03:15,23

![01-03-15](tmp/01-03-15.jpg)

你要说它不是这三角形吧

也不能这么说对吧

它基本上形状跟它一致嗯

但是大家很明显可以看到一个东西叫做锯齿对吧

这个锯齿就是这个相当于是光栅化图形学里面

这个一直在致力于解决的一个严重问题

好吧

这就这个锯齿的原因到底是什么

从这个这个图大家就已经可以看出来

是因为这个像素本身它自己有一定的大小对吧

然后并且我们的采样

如果如果咱们用下节课将要讲的内容

就是说我们的采样率对于这个信号来说是不够高的

所以产生了这么一个信号的走向问题好吧

然后这个所谓走样大家可以看到叫做 ali a alien

### 01:03:59,46

![01-03-59](tmp/01-03-59.jpg)

在这个我们的光栅化图形学上就体现在锯齿上

那么咱们之后自然而然的一步工作就是要抗锯齿或者反走样

这就是咱们图形学中的一个重大的技术

那咱们之后会在下节课里面给大家说好吧

那今天这个咱们就说到这儿

正好这个呃圆满完成

还提到了这个这个这个走样问题

那咱们下节课会给大家说这个呃嗯关于怎么样去做反走样啊

然后这个并且会着重给大家分析一下

在这个在这个频率上如何去解释这么一个走向问题

从这个采样的方法上来看

这样的话这两节课大家对比着就会知道

这节课为什么这么一个简单的话题

咱们一定要通过这么一个采样这么一个概念去分析它啊

把它给转化成一个理论上的问题

好吧

下节课大家就知道了啊

好那咱们今天这个嗯就说到这儿好吧

然后在这啊

我我这样吧

我现在先来看一看大家这个今天的课上会有什么问题对吧

但是这个嗯内容相对较多

所以说我没来得及给大家回答这个事情啊

好吧嗯似乎没有什么特别困难的问题对吧

然后就是说这个 ok 啊

那挺好的

那说明今天这个这个大家这个理解的都挺到位

没问题

好

ok 那没问题

但是这样哈就是说呃还是一样

下节课这个预告一下

下节课绝对不容易

因为特别是对于咱们没有接触过这个信号处理的同学

可能下节课会相对较难

但是我希望下节课咱们把这个事情给说清楚

这样的话联系到这个这节课的这个内容

大家都知道这个采样到底是一个是是怎么回事

以及怎样的基本这个这个成因以及解决办法

好吧嗯

ok 那咱们今天就到这儿

然后咱们把时间交给这个呃这个这个技术秘书同学

然后谢谢大家好

那咱们下节课再见啊

### 01:06:06,6

![01-06-06](tmp/01-06-06.jpg)

拜拜
