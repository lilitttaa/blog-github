---
title: Games101 13.Ray Tracing 1(Whitted-Style Ray Tracing)
---

## Ray Tracing

### Overview

为什么要引入光线追踪：
![Alt text](image.png)

- 对于全局效果不好解决，比如阴影、glossy 反射（金属反射）
- 当然不是说不能做，但是比较麻烦，而且不能保证物理上的正确性

![Alt text](image-1.png)

- 光栅化本质上来说是一种快速的近似

![Alt text](image-2.png)

- 光线追踪是一种准确的方法，但是它的问题就是非常慢
- 过去光线追踪常常是用来做离线的应用，比如电影
- 比如说这里的迪斯尼的电影，一帧需要 10k 个 cpu 小时

在开始光线追踪之前我们需要先来对光线做一些定义：
![Alt text](image-3.png)

- 光线沿着直线传播
- 光线不会发生碰撞
- 光路是可逆的，也就是说我们可以认为光线从光源发出，然后经过四面八方反弹进入人的眼睛。也可以认为人的眼睛发出光线，然后经过四面八方反弹进入光源。

![Alt text](image-4.png)

- 过去很多人都认为是光从眼睛发出，照射到物体上，然后被物体挡住，所以我们看到了东西。当然这个观点是错误的。

![Alt text](image-5.png)

- 我们假设相机前有一块虚拟的屏幕，屏幕上有各个像素。
- 所谓光线追踪就是指，我们从相机出发，对于每一个像素，我们都打出一条光线。光线会到达场景中的某个位置，或者和场景中的某个物体相交。
- 然后我们把相交的点和光源做一条连线，判断这个点是否被光源可见，也就是判断这个点是否在阴影里。
- 如果可见，那就形成了一条有效的光路，从光源到这个点，再到眼睛，然后我们就可以计算这条光路上带的能量，从而计算出这个点的颜色。

![Alt text](image-6.png)

- 我们假设眼睛是一个点，光源也是一个点光源
- 对于场景中的物体，我们认为光线打到他们过后会发生完美的折射或者反射。
- 我们发现光线追踪的方法很自然的就解决了之前需要做深度测试的问题

### Recursive (Whitted-Style) Ray Tracing

![Alt text](image-7.png)

- 刚才我们说的光线追踪只考虑了光线弹射一次的情况，实际上光线可以弹射很多次。
- 这里我们介绍一种叫做 Whitted-Style 的光线追踪方法，它是一个递归的算法。
- 左边的球在做折射，右边的球在做反射。

这个递归算法具体的工作流程如下：
![Alt text](image-8.png)
![Alt text](image-9.png)
![Alt text](image-10.png)
![Alt text](image-11.png)
![Alt text](image-12.png)

光线投射可以可以这个呃每一个像素啊

我们找到最近的这么一个这个点对吧

然后呢我们考虑在这个点上

如果这个球啊本身是一个这个呃玻璃球

那我们知道当一个这个光线打到玻璃或者什么这种这种透明的

这种这种介质上

肯定有两种现象发生

第一有一部分能量要被反射掉

另外有个能量要要折射这个进去对吧

然后这个但是这个比如小时候都做过这种物理实验对吧

有一个这个激光打到这个水面

然后大家会发现一部分要反射

一部分有折射进去

这里一样没有问题

我们知道有多少能量会沿着它的反射方向诶继续传播

那也就是说啊

我们从眼睛投射出来光线打到一个点的时候哦

如果这是个玻璃的材质好

那我知道我对啊

我在这个点上应该要做一个镜面反射

还记得咱们刚才假设吗

我们假设这个反射都是完美的反射啊

这里就是这个这个作威特的风格

他假设的内容好

然后这里呢这这条光线当然大家知道这是反射光对吧

没问题

然后呢嗯同样道理

这根光线咱们刚才说了

到这里它是个玻璃球

它还可以折射进去对吗

它可以折射进去

然后呢这个在内部再传播

他肯定还会打到另外一个点

打到另外一个点再折射出来对吧

也就是说它这个咱们看啊

比如这一条所谓光路啊

这个也就是说它可以弹射很多次

无限次

这个可以永远的一直这么做下去对吧

这是没有问题的

然后嗯就是说啊这个 wait 的风格

他说的其实就是这么一个意思

只需要这个你正确的算出来它的反射方向

折射方向就可以了

好那么呃还是一样刚才的定义哈

这个这两条光线自然就是折射光

没有问题好

然后呢在呃这个 waited style 这个这个光线追踪里面啊

它所算的这个着色也发生了一点点变化

是什么呢

就是说啊我这里原本说光线投射投射找到这个点之后哦

这个点看是不是能被照亮

然后我就计算它的着色

但在这里由于光线这个弹射的次数多了呢

我其实在每一个彩弹射的点

我都会去计算它的着色的值

就是这么个意思

大家可以看到这里呢

一共这个这个目前每一个这个和场景中间的交点啊

我都去和光源做一条连线

诶

我去看在这个点上

这个光源是不是能够照亮它

就是这么个意思

比如说像这个点

咱们认为能够照亮这个点呢

自然就被这个三角形挡住了

就照亮不了这个点呢就可以被光源所照亮

那么这样一来呢

其实啊最后嗯这个 wait 的风格光线追踪算了一个什么事情呢

算了一个啊

就是说我的光源如果可以照亮任何一个这个弹射的这个点啊

那我就把这些这个弹射的点

这个内部就是我算出来的这个着色的值

都给最后加到这个像素的值里面去啊

是这么个意思

就是说我在这一点算一个着色

那么在这一点再算一个着色

这两点的着色都会被加到这个这个像素里面的这个值里面呃

这个很简单对吧

因为有这个嗯嗯其实这里已经定义了两种不同的光路了

一条是什么呢

一条是这个你看呃光源到这个点再到人的眼睛

然后另外一种传播方式是光源到这个点到这个点再到人的眼睛对吧

那光光自然可以往各各种各样不同的地方传播

所以这两个路径都是可行的

所以它会把两个部分的着色的结果都给加回去

那同样道理

这个地方还会发生一定的折射

那折射这里也是对于这个点和这个点

它会形成这么一条光路对吧

然后以及这边这边被挡住了

那就没有这个光路

但是如果有的话

他也会把这点这点加上

就是光源到这个着色点呃

到这个着色点

这个着色点最后到一点里面好

他就把这些着色的值呢全部都算进去

那么大家看到了

为了算着色

我要算它的可见性

每一个这个弹能弹跳的这么一个点啊

我都要这个连一条这个所谓的 shadow

然后我来看他是不是在阴影里

是不是应该算它的这个这个呃就是最后的值得这个贡献对没问题

然后有同学反映说这里是不是有能量损失

当然了

否则的话他这个经过不同的这个这个越来越多次数的这个弹射啊

那可不是说这个能量会这个一直累加一直累加

那最后看到的结果可就是这个完全就是类似过曝的这种图了

对不对

就是说完全是白的嘛

就是说这里啊大家可以看

比如说在这一点原本能量过来

假设百分之百

那么呃我们认为比如说啊折射的这个能量呃占了 40%

而这个能量占了 60%

那自然这些都是会考虑进去的啊

这个没有问题好

然后嗯呃我们在这里呢再简单再定义一下这个事情

这个是是就是说啊对于不同类型的光线

我们在这里做一个简单的归类

很简单

什么呢

就是说之前我们定义了 camera a 或者 iv 对吧

就是从眼睛这边开始打出来的第一根光线

往各个像素这个嗯这个中心连的这些光线 um

那么这些光线又被称作这个 primary

然后在之后的这些这些弹射

它就是说在一次弹射之后

这些这些光线我们都可以管它叫做这个 secondary race 好吧

然后呢我们又区分一下

我们往光源连的这些连接

我的判定可见性的这些叫 shadow y

这也是大家不同的一些分类吧

反正这也好理解

没问题啊

啊这是基本上这个这个 wait 的风格的这个光线追踪的一个做法

那么大家可以看到这个最后把结果呃

无论如何把这些光路的结果全部加到这么一个点上面去

呃这像素上面去我们就可以看到最后的这个结果

### 00:29:07,50

![00-29-07](tmp/00-29-07.jpg)

那么这从这个结果上

我们其实还可以看到一些这个其他的这些这些信息

比如说啊比如说嗯这个阴影

这个阴影看起来就是就没那么暗对吧

这边这个阴影呢就相对较为暗

那么这是为什么呢对吧

大家可以想象呃这里怎么来的哈

就肯定是说我有这个呃嗯一根光线从 camera 出发

然后连向某一个像素

然后它打到地板上的一个点

然后基本上一个点呢

然后他这个这个往某个方向

然后去这个弹射

然后我会发现它会穿过这个玻璃球

然后还会接触到一定的光照

没问题吧

从这个角度上来说

就是说嗯这个对于镜子的球

它会挡住这个这个所有的这个光照

然后对于这个这个玻璃的球呢

然后这个呃这个光线会有办法能够穿过它

然后自然这里会收到更多的能量

当然它本身肯定涉及到有能量衰减

所以一定会投射出来一个阴影

只不过会非常这个这个蛋就这么个意思啊

就是说这样一来就可以看到这个呃这个所谓 wait 的风格

光线追踪的好处了对吧

那么有同学说这中间有很多这些技术问题

我没有说对吧

我们挨个儿之后解决

就是怎么判定是不是这个光线被遮挡住对吧

怎么怎怎么在这个判断说这个光线投射出去会打到哪里

怎么样求这个呃这个呃所谓的反射光的方向和折射光的方向对吧

以及他们各自带的能量

这能量得守恒啊对吧

然后就是说这个衰减又应该怎么算

但是不管怎么样啊

刨刨除这些

这个咱们不说的这些

这个就目前还没还没交代的这些这个技术细节啊

就是单说这个呃光线追踪本身所谓 waited style 对吧

然后这个还是挺好理解的

我觉得基本上来说就是在模拟光线不断弹射的过程好吧

那么行没问题嗯

到这里呢就是说把这个基本原理告诉大家

那么咱们现在开始一个一个来解决这个技术问题

那咱们要解决的第一个技术问题就是要求这个焦点没错吧

### 00:31:10,0

![00-31-10](tmp/00-31-10.jpg)

就是说啊在这个所谓着色各种各样的这个之前

咱们这个肯定最早是说光线投射出去之后要打到谁对吧

也就是说交点怎么求

### 00:31:22,0

![00-31-22](tmp/00-31-22.jpg)

我们要求光线和物体表面的交点好

那么这里呢我们既然要求焦点呢

肯定涉及到各种各样复杂运算

那咱们先把数学上的光线给定义出来

那么所谓光线其实在数学上它就是一个射线

对不对

很简单

有一个呃起点对吧

有一个起点有一个方向

那咱们之前说过方向都认为是单位向量没问题啊

然后有一个起点

那么怎么定义呢

一个点光源啊

我们认为点光源

然后呃或者说这个光线的起点是某一个点

我们认为是 o 啊

然后它的这个这个传播方向

它的传播方向我们认为是 d

所以说我们就用这两个这个这个量就可以定义一条光线

非常简单的事情

那么在光线上的任何一个点我都可以用 o 加上 td 来表示对吧

因为沿着这个这这这条光线啊

这无非就是说这个呃从 o 开始往 b 方向走了多远

那所以当然就是 o 加上 t d

那这里呢由于光线是射线

所以说我们认为这个光线啊它只能往这往一个方向传播

所以 t 大于等于零小于无穷大

而这个时候呢就是我们在回到之前所说

这个我们通信学里很少去考虑这种这种边界的这种条件

比如说 t 到底是我们认为是大于零还是大于等于零

其实问题不大啊

就是说那咱们就这么理解

这简单地定义了一条射线

也就是说任何一个沿着这条光线的任何一个点

我都可以用简单的这个 rt 也就是 o 加 td 来表示

这个没问题啊

简单那呃都是什么意思啊

就是说任何一个点沿着一条一个光线

我们叫 r 点对吧

在这个 t 时间

它是这个从这个起始位置加上 t 乘以这个方向没什么问题好

那么我们来说这个最简单的这个情况啊

### 00:33:02,50

![00-33-02](tmp/00-33-02.jpg)

光线如何与各种不同的物体求交

咱们从最最简单的物体来说

光线怎么和球去做焦点好吧

那么咱们这个光线的定义

咱们刚刚说 o 加上 td

然后球的定义

球的定义

这个是也是一个挺简单的定义对吧

就是说我们可以把它的这个隐函数的表示解出来

然后就是说球上的任何一个点啊

然后这个到到什么呢

到他这个球心的距离

球心 c 的距离都等于半径啊

就说的就是这么个事情

超级简单的一个定义

所以这就是为什么 p 减 c 的平方减二的平方等于零对吧

这是这是对于这个呃三维情况下来说

它就定义了一个这个球的表面对吧

那么我们现在要求光线和球的交点

那这个要怎么做呢

那我们就在就想这么一个事情

数学上我们如何定义一个交点

什么叫交点对吧

这样想

那交点其实就是说这个点它又在光线上

又在球上啊

那这个才是叫交点

那么既然这个点又在球上

又在这个这个光线上

那它势必要满足这两个这个不同的这个物体呃

它表示的这个这个函数

两个函数都得满足对吧

它它是既在光纤又又在这个球上对吧

所以都得满足的话呢

那我就说任何一个这个球上的这个点 p 对吧

它同时也一定是沿着这个光线走了这个某一个时间的

也就是说啊我可以说 o 加上 tb 这么一个点减去这个球星

没错吧

也就是说这个点 p 它又满足 o 加 td 又满足这个下面这个式子

p 减 z 平方嗯

减 r 平方等于零对吧

那我们就可以把两个合在一块儿考虑

那和在一块考虑什么量

我们是不知道的啊

我们要解这个焦点

对不对

那这个焦点现在我们看了这个这个这个 o 点这个地方向

然后现在不知道的呢

就是这个 t 对吧

就是传播多久可以打到这么个球

就这么个意思对吧

那么我现在自然而然有这么个式子

我就可以把它解出来

怎么解出来呢

### 00:35:09,50

![00-35-09](tmp/00-35-09.jpg)

那大家可以看到它无非就是一个二次函数

然后这个呃我们可以把它给展开成这个 a t 平方

加 bt 加 c 等于零的形式对吧

我们为了解除这个 c 嘛

然后呢这个二次函数怎么样求解这个根呢对吧

这个很简单

那么直接可以解了出来

大家还记得这个公式吗

对 2a 这个这个分之负 b 加减根号下

这这这么这么些东西对吧

然后这个 a abc 分别都是什么

这是数学运算啊

没有任何这个困难的地方呃

这个就是说简单的把这个式子展开整理成这个这个二次的形式

然后就可以解除这个 t 是多少

那么根据我解出来的 t 的这个数量

首先我们这个要满足这个 t 得有这个物理上的这个实际意义

t 得是这个呃正的对吧

我们刚才说他是这个光线是射线嘛

t 的是正的

这是一第二呢这个嗯就是说呃解出来的这个这个嗯解出来的这个根

他要有实际的这个这个物理意义

也就是说它不能是个虚数

它得是这个实数

所以 b 平方这个一定得大于等于 4a c 的时候才会有个交点对吧

然后根据这个这个呃光线所在的直线和这个球的距离关系

当然之前大家几何上也都学过这个问题对吧

就是说这个有存在相离相切和相交的情况

然后这样我们就可以解除这个不同的点对吧

假如说相交

我们可以求出两个不同的 t 其中一大一小对吧

那我们要求这个最近的

那么肯定取决于最小的 t 那就是最近的焦点很简单

那这个对于一个这个和球的这个求教啊

光线和球球球的球球无非就是解散函数没什么问题

那咱们其实可以把这个问题啊

### 00:36:46,50

![00-36-46](tmp/00-36-46.jpg)

给推广到光线和一般性的这个影视表面的求交

那什么意思呢

大家还记得吗

影视表面的定义就是说我定义这个点满足一个什么样的性质对吧

就是说我定义一个点 p 这个点使得某一个函数会等于零

那这刚才对于球来说也是如此对吧

很简单的一个定义

那么我们现在要求光线和这个影影视表面的焦点同样思考对吧

同样思考

那这个焦点一定又在光纤线上

一定要在这个影视表面上

所以这个点 p 一定可以写成 o 加 td 的形式

所以咱们就可以把它写成 fo 加 td 等于零

剩下的事情就变成了好

我给了一个函数

里面有一个未知量是 t 然后我现在要把这个题解出来

对不对

解出来记得两个事情

第一我们要实数

不能是虚数

然后要让物理上有意义对吧

然后第二我们需要是正的

这是因为是光线

是这个这个是射线对吧

t 一定得大于等于零好

那么嗯把这个条件加上

咱们把这个值解出来

### 00:37:51,0

![00-37-51](tmp/00-37-51.jpg)

我们就可以这个把不同的各种各样不同的这些这些复杂的这些呃

影视表面对应的这个这个这个表面和光和光线做这个求教

而且很容易解得出这个值

然后呢目前来说嗯这个数值计算的软件啊

现在是非常发达的

就是说怎么样去解这么一个式子

现在很少大家去关心这种事情

就是说甚至你不用

你不需要用什么数学的方法直接去求

直接用数值的方法去做优化方法

直接去求一个函数的这个根就可以了对吧

然后这是很简单的事情

所以说嗯对于一般性的饮食表面也是这么做啊

解出来一个时间 t

那解除时间 t 之后

大家问他

那这个焦点在哪儿啊

那就是 o 加 td 呗

t 已经知道了对吧好

那么没问题

### 00:38:34,0

![00-38-34](tmp/00-38-34.jpg)

那么我们刚才说啊

对于一般性的饮食表面

那对于显示表面怎么做

对不对

然后显示表面里面我们刚才就说啊

最最重要的显示表面是什么

咱们之前课上已经几何上已经说了对吧

所以这些知识啊其实都是联系在一起的

那么对于这个显示的表面呢

我们就说光线和三角形求角其实是一个非常非常重要的话题对吧

然后这个呃光线如果我知道它如何和这个三角形求交

我就能找到焦点

我能判断是不是这个光线被遮挡

然后还有一个很有意思的应用

这里给大家列出来

就是说啊这个通过光线和三角形的这个求交点这么一个事情

我甚至可以判断给你一个点

这个点是不是在这个物体内啊

或者说这个这个点是不是在物体外面

那这个这个是怎么做到的呢

很简单

大家可以试着在纸上随便画任何一个封闭的一条一条曲线啊

比如画一个这个这个就是说正方形对吧

圆形什么都是可以的

然后在这个在这个形状内部啊

点一个点

然后我随便往哪条方哪个方向啊

去这个去去去打一根光线出去

然后我判断这个光线和这个物体有多少个交点

你会发现一个很神奇的现象

就是说如果你点的这个点

它是在这个在这个形状内的

你得到的交点数量一定是奇数啊

记得光线是射线哈

不是直线哈

射线啊

就是说你随呃随便取一个点

随便取一个方向

定一个光线

找这个交点数

然后呢这个如果你得到的是奇数个交点

那它一定在这个物体内

如果是偶数个交点

那一定是在物体外

这个事情推广的 3d 仍然是这个这个可行的

所以这个非常有意思的一个属性啊

这个大家可以试一试好

那么嗯好

这里呢就是说嗯就是一个应用吧

算是好啊

当然前提是得这个物体本身得是封闭的啊

就不能有动

有这种情况就不能判定是不是内额外了啊

ok 那么行

那么我们现在回到这个这个啊光线和三角形求交啊

这是最最基础的一个操作好吧

### 00:40:39,50

![00-40-39](tmp/00-40-39.jpg)

那么我们考虑一下怎么样做光线与三角形求交

然后最最简单的做法

那我可和光线和三角形面

我要判定和这个物体

比如说这个光线和这个小奶牛它怎么样啊

这个有有没有交点

那么我就一个一个三角形判断它是不是和这个光线求有交点对吧

那我可以求出来很多交点

那哪一个交点是我们要的呢

最近的这个对吧

t 最小的这个对吧

所以这个思路肯定是对的

没问题

如果我要判定这个光线与这个三角形面物体啊是否相较

我就一个一个的三角形来看对吧

那么当然大家可以可想而知

这是非常非常慢的一个事情啊对吧

然后我这光线和三角形求交

每一个三角形都求教一个这个物体

它就有比如说 10 万个面

然后呢我这个整个一个屏幕的分辨率是是这个这个这个比如 4k 的

然后我每一个像素都要打一根光线

每一个像素这个数量级再乘上 10 万

这还得了啊

这个计算对不对

非常慢

没问题

咱们留到之后说好吧

然后呢就是说我们想象一下

如果我们就用这种简单的方法来做

那任何一个三角形给给定的三角形和你给定一条光线

它们两个求交点

求焦点呢要么得到零的交点

要么一个交点

那同样道理

咱们图形学上呢很少考虑这种这个呃平行的这种这种情况对吧

就比如说一根光线完美的通过了这个三角形

并且通过它所在的平面这种情况

这种情况咱们就直接忽略了好吧

然后就是说我们就考虑是三角三角形和这个光线

会有一个交点或者零的焦点啊

这种情况好

那么嗯嗯没问题

### 00:42:22,0

![00-42-22](tmp/00-42-22.jpg)

那这就是咱们要提到的一个重要的这个话题啊

怎么样去做光线和三角形的交点对吧

然后呢这里人们呢发现了一个办法

怎么样

这是求光线和三角形交点呢

因为三角形肯定在一个平面内对吧

三角形在一个平面内

那我就把这个问题

三角形和光线求交分解成两个问题

第一光线和平面怎么样去掉对吧

然后找到了一个焦点之后

我在判定它是不是在三角形内

那当然是可以的对吧

咱们把这个问题就进一步简化了三角形

光线和三角形这个这个球球交呃

不知道怎么做

那么转化成光线和这个平面求角

然后我在判定点是不是在三角形内

而大家会发现要点在三角形内

这个作业里面我们做过对吧

我们知道怎么样判断

那现在的问题就变成怎么样做光线和平面的求交

哎这是个问题

那咱们看一看光线和平面求教

还是延续咱们刚才最早的思路

怎么样去做这个焦点

我们得先把这些物体定义出来

那么光线的这个数学定义 o 加 t d 对吧

早就已经定义出来过了

那么现在平面咱们得先想办法把它给定义出来对吧

然后呢那咱们就先想这个平面如何去做定义对吧

### 00:43:29,50

![00-43-29](tmp/00-43-29.jpg)

那想一想呢

平面我们可以定义成是一个方向和一个点

### 00:43:37,0

![00-43-37](tmp/00-43-37.jpg)

这是什么意思啊

就是说平面它肯定得有一个法线

对不对

如果我定义了一个法线

我是不是就定义了一个平面呢

呃这个这个事情呢是不是不够的

就是说比如说我定义一个向上的发现啊

我说我要定义一个平面

我给他一个发现

这个平面必须得是这个法线的

呃

就是说他冲着这方向

那这个平面就是就是类似这样的

但是呢我这个平面可以沿着这个法线这移动

对不对

也就是说我定义一个法线是不够定义这么一个平面的

那怎么办呢

我在定义好这个平面一定得过某个点

就是就是咱们画的这么一个意思

那那从这个例子上大家都可以明显的看出来啊

想定义一个平面

那么给平面上的任意一个点

然后再给这个平面的法线嗯

那就够了对吧

那咱们现在说说怎么样定义平面

是指这个平面上的任何一个点应该满足一种什么样的条件对吧

和刚才咱们定义这个光线是一样的

就是光线上的任意一个点都满足它能够写成 o 加 td 这么一种形式

这个 key prime 和它的法线 n 来表示是可以的

满足 p.p prime 这么一个向量呃

和这个法线是垂直的就行了

这个是什么意思啊

大家可以想一下啊

法线是什么意思啊

这个方向是要和平面垂直的

那既然和平面垂直

那肯定和平面内的任何一条线段要垂直

那如果说我有一个点在平面内

那么我这个平面的这个这个点和这个呃给定的这么一个点

p prime 这么一连线

我会发现哦

那当然它是合法线垂直的

没问题对吧

那如果这一个点它在平面外

大家会发现你比如说在这个平面底下吧

在这个位置

然后这个位置和这个 p prime 和平面上的这个点一连接

我会发现哦这个向量得出来的向量和这个法线不垂直

那也就是说我就是说只有这个点 p 在平面的时候

在平面上的时候才能够满足这么一个性质

定义的任何一个这个 p 点啊

那这这是一个很简单的式子

然后就是说如果大家把这个式子展开之后

把这个什么这个 p 点写成 xyz

然后把 p prime 写成 x0 y0 z0

然后 n 再给一个什么 n x n y n z 展开了之后

他就会发现诶它满足了一个这么一种性质

就是 ax 加 b y 加 cc 加 d 等于零

然后这个很显然这是大家学过的这个平面的方程对吧

也就是说我们这种定义诶

通过一个直观的几何上这个垂直不垂直这么一个定义

我们就可以定义任何一个在平面上的点好

那么我们现在就等于把平面已经定义出来了

所谓平面就是一系列这个 p 点的集合

使得这个 p 点呃和这个给定的 p prime 点的连线和给定的嗯拔线垂直

很简单

那么嗯 ok 然后咱们就就用到了之前定义的这两个嗯

这两量嘛对吧

一个是平面上的点

一个是平面的排线好

### 00:46:42,0

![00-46-42](tmp/00-46-42.jpg)

那么现在我们就可以来求光线和平面的这个交点了

那怎么办呢

那同样道理

焦点一定又在光线上

一定又在平面上

所以这个点 p 一定又可以写成 o 加 td 的形式

所以咱们又回到刚才的这个这个做法对吧

### 00:46:56,50

![00-46-56](tmp/00-46-56.jpg)

大家可以看到啊

这个满足这个平面的方程就等于零

我们把这个点 p 呢换成沿着这个嗯这个这个光线的这么一个点对吧

然后沿着光线的 o 加 td 诶

好我们把这个带进去

然后我们现在仍然要把这个 t 点求出来诶我发现这个 t 挺好求的

因为这里还不涉及到什么二次的事情

大家看到了这个对吧

这几个量 o d p prime 和 n 这我都知道对吧

我都知道

然后我要解说这个 t 是简单简单的

不能再简单对吧

我把这个 t 直接这个把这个这个函数这个叫什么

把这 n 这个分配出来

把这个比如说 o 减 p prime 点成 n

然后加上 t 呃

乘以 b 点成 n

然后这个 t 呢自然而然就可以写成这个形式

解出来 t 之后

我们在判断还记得吗

得是正的

然后得是这个实数

那当然它本身是个实数

它本身这些所有其他操作数都是实数对吧

然后呢那他得是正的

我得确认这个 t 得大于等于零

好没问题

那这样的话我就可以解除呃

这个光线和平面的交点

那光线和平面的交点之后

下一步是什么呢

就判断这个点是否在三角形内就可以了对吧

那么这个事情呢其实说算是一个相对简化了的这个写法对吧

就是说就是呃就是说一种简化的思想呢

可以这么说

我怎么样去求这个点呃

和和和三角形这个呃呃光线和三角形如何求交

那是先求和平面的交点

在判定时候的三角形内

那么人们啊这都是这个懒的

对不对

懒是人类进步的动力

我们之前一直这么说对吧

那么人们就在想

有没有办法我能够一下解出来这个光线和三角形的交点

我解出来之后

我立刻就可以判定这个这个是不是在三角形内

答案是可以的

怎么做呢

人们发现了一种这种方法

### 00:48:44,50

![00-48-44](tmp/00-48-44.jpg)

这是这个算法呢叫做 mer trouble

呃

这个这个算法啊

我们就管它叫 mt 算法好吧

然后这个算法在做什么事情呢

其实相当简单

大家看啊

这个这个式子就是这个算法在做的这个核心的这个这个嗯呃怎么说呢

要解决核心问题哈

大家看到我要求光线和平面的交点

那 o 加 pd

大家知道这个是光线对吧

这这这光线上这任意任意一个点

这个点肯定还得在三角形内

然后如果这个点在三角形内

我就肯定可以把它写成这个呃

这个用重金坐标描述的这个这个位置上

比如说大家看这里啊

大家看到这个一点 b1 b2

又看到 b1

看到 b2

看这个是不是觉得很熟悉

对不对

然后因为什么呢

因为这三个系数加起来正好等于一

而他们分别又是这个 p0 p1 p2

这几个量加起来我们知道哈

就是说嗯只要说这三个系数加起来等于一

我们就可以得到任意一个

在这个三个点所定义的三角形所在的平面内的点对吧

这也就是说这是这个平面内的任意一个点

用重心坐标表示的平面内的点

然后呢我这个 o 加 td 是这个光线上的一个点诶

但这两个肯定是要这个既然是交点

两个得同时满足它两倍也是一同一个点啊

那这样的话我就只需要解除什么呢

解除时间 t 这我不知道对吧

b1 b2 和这个一减 b1 b2 我也不知道对

但是因为它们加起来等于一

所以右边这是两个变量

b 一跟 b2

左边是一个 t 好

那我就就可以说我想办法去把这个式子给解出来

然后这个式子解出来非常的容易

为什么呢

因为大家可以看到啊

这个这个 o 啊

这个 d 啊

这些量它都是这个三维的这个向量

对不对

点或者是这个方向对吧

然后就是说它是三维的

也是一个会表示三个数

那说白了就是说我们有三个这个公式呃

三个式子吧

三个式子有三个未知量

那我当然可以把它解出来

这是什么呢

这就是线性方程组

那解线性方程组

大家回到之前的线性线性代数的概念上啊

就是说怎么样解一个线性方程组

也就是说有 n 个式子

又有 n 个这个变量呢

我们要用一个东西叫做 armer 法则

这个 ramer 法则呢这个这个如果大家记得的话

这个呃这个自然而然可以理解

不能记得的话没有任何关系啊

就是说这个式子你只要能列出来

你知道哈有三个变量

三个式子你肯定能解出来

然后你通过解出来

你就会发现啊

它就是这个它定义的这么一种这么一种方式

大家会看到它定义了好多东西啊

什么 s 啊

e 啊

123 之类的东西

然后这个其实都有明确的定义

无非就是你的这个输入

比如说这个三角形三个顶点

人的这个位置啊

和这个光线的起点和方向的一些一些不同的组合

还是叫插成对吧

虽然比较麻烦

但是解这个式子是非常非常非常直观的

式子

解出来之后怎么办

肯定有同学要问对吧

解出来怎么办

那要判定这个解是否合理

那什么呢

什么合理呢

第一沿着这个三角形方向

也就是 t 还是得是正的对吧

这是第一

第二个式子是第二个

这个要点是我得知道这个点在三角形内

那对于这种这个呃重心坐标表示了这个三角形

嗯对于对于嗯重心坐标表示的嗯三角形所在平面上的一点

我怎么知道它是不是在三角形内呢

那也就是说这三个量都得是非负的对吧

也就是说 b 一是非负的

b2 是非负的

然后一点 b1 b2 也得是非负的

是否这个点在三角形内对吧好

所以说呢这个没问题

然后这个解这个式子呢咱们就不多说啊

就是虽然说这是一个某个什么样的算法

但说白了其实也是这个以另外一种不同的形式去描述这个平面嘛对吧

然后之后我们立刻可以判定是否在三角形内啊

好那么这样一来呢

呃光线和三角形求交

咱们就等于一下就可以求出来

不用先和平面求交

这个这个意思啊

说是但是这个本质上还是一回事啊

ok 那么到此为止

### 00:52:47,0

![00-52-47](tmp/00-52-47.jpg)

就是说我们这个光线和三角形求角已经知道怎么做了对吧

还回到咱们刚才说光线和这个三角形的这个这个面嗯

就是说它表示什么一个物体怎么样求教

咱们刚才提到最简单的办法

把把光线和每个三角形都做一次这个求教

然后我再求这个最近的焦点

找出最近的焦点 t 最小的

这不是很简单吗

对但是它很慢

那咱们想个办法怎么样把它给呃速度提上去对吧

那这就是我们要说的下一个话题

光线和这个表面

那所谓这个表面呢

其实我们说的更多就是三角形表面好吧

就是用三角形形成的这些三角形面好

### 00:53:33,0

![00-53-33](tmp/00-53-33.jpg)

其实这个咱们刚才已经分析过了对吧

这是呃必要的一件事情

就是如果我们用我们刚才说的这种最原始的做法

我们当然可以求出光线

这个这个和整个场景嗯的最近的一个焦点绝对没有问题

我们把所有的这个物体对吧

都考虑进去

所有的三角形数量都考虑进去

然后然后这个每一个像素我打出一根光线

然后要和所有这些三角形求一次交点

然后这就是这么多次计算哈

这里 object 呢其实指的是算是三角形的数量吧

这么理解好吧

然后如果我在这个光线的场景中弹射多次

那我每一个光线是不是这个这个每一次弹射

我都得计算一次新的光线和这个物体求教和这个整个场景求教

那这个就就已经这个慢的不行了

对不对

那所以说我们肯定不能这个简单这么做

那那怎么办呢

那就是说我们想办法去这个这个呃

### 00:54:27,0

![00-54-27](tmp/00-54-27.jpg)

提高它的这个这个呃渲染的这个效果好

那么我们看一下啊

这个呃这是一些非常非常复杂的场景的例子

这会给大家一个很明确的概念

说这个场景我绝对绝对不能用我之前提到这个最最原始的方法来做

比如说这个场景

大家看到这个场景极其复杂

而且这个场景是一个经典场景

叫 3 米 6

然后这个场景有多少呢

有这个嗯你想一想啊

medic 它应该是有 1000 多万个三角形

然后大家想 1000 多万个三角形

你每个像素假设你就一根光线

因为每一根光线都要和 1000 多万个三角形

然后你这个这个求交

然后结束之后再乘以这个像素数

这还得了

特别是大家看到这些细节的这些东西

这叶子是什么东西的对吧

这个这个场景极其复杂

当然还有一些这个呃玻璃的东西嗯

就说明光线肯定弹射不止一次

那肯定是一个更复杂的问题

那么另外一个呢这里在呃看这这么一个场景啊

### 00:55:24,50

![00-55-24](tmp/00-55-24.jpg)

这么一个场景大家可以看到有一个室外的场景

各种各样的树叶

然后各种各样的植物

然后各种各样的草

大家可以看到这个草的这个叶子一个非常细

然后每一个叶子呢都可能有好多好多个三角形来组成

这里是 2000 万个三角形对吧

然后所以说非常非常多的三角形

那么这个这个如果用原始方法肯定是不行的

### 00:55:48,50

![00-55-48](tmp/00-55-48.jpg)

那么嗯我想一想哈

### 00:55:50,50

![00-55-50](tmp/00-55-50.jpg)

考虑到这个时间嗯

ok 行吧

那没问题呃

是这样

我这个这个尽量的把这块给给说完吧

好吧

ok 那这个刚才大家看到的这些例子哈

### 00:56:06,0

![00-56-06](tmp/00-56-06.jpg)

那咱们嗯嗯提供不同的方法吧

这样说哈

然后叫什么呢

就是这么个意思呃

这个听上去很别扭

是什么意思呢

我们给大家举个例子

### 00:56:29,50

![00-56-29](tmp/00-56-29.jpg)

诶

这怎么做

就是说啊比如说我有一个复杂的物体

保证这个物体一定在我的这个这个简单的这个形状之内

那对于这个二维的情况

大家看到一个茶壶

我可以用一个这个呃某一种这个所谓 box 对吧

对这一个一个矩形把它给框起来

我也可以用一个圆形把它给框起来

这个没有关系对吧

我用任何一种简单的东西把它给框起来就可以

咱们就就用这个概念吧

这里有一个逻辑问题

大家把这个想清楚就没问题了

这是什么逻辑问题呢

这是没有任何问题的

对不对

那这个思路虽然简单

但是但是啊非常非常的这个有效对吧

这个这个逻辑就是说啊

里面的东西

我根本不用看

就是这么个意思对吧

### 00:57:41,0

![00-57-41](tmp/00-57-41.jpg)

那咱们现在再看对于三维的情况

也就是一个这个长方体

那咱们现在呢多看一眼这个长方体到底是什么意思啊

大家可以看到这个右边画了

这是一个简单的长方体对吧

那这个长方体呢它它我们要怎么理解

对平常我们的理解呢

就是它是在空间中的一块区域

对不对

然后这个 xyz 各占了多少

这个范围对没问题

但这次咱们先想办法把这个长方体给这个用另外一种方式来理解

我们理解成什么呢

理解成长方体是三个不同的对面的这个这个这个嗯形成的这个交集

什么意思呢

咱们看这个意思啊

### 00:58:33,0

![00-58-33](tmp/00-58-33.jpg)

所谓三个不同的对面是什么意思呢

就是说比如说看这个这个长方体啊

这个前后这么两面啊

这个面和背后那两个面咱们认为是无限大的平面

那这两个形成了一对面

这么考虑啊

形成了这个前后这么的对面

### 00:58:53,0

![00-58-53](tmp/00-58-53.jpg)

那同样呢这个上下这两个面

然后我认为也是无限大的平面

它也会形成上下这么一个对面

没问题啊

然后左右同样没有问题

### 00:59:01,50

![00-59-01](tmp/00-59-01.jpg)

左右也可以形成这么一个对面

那么现在再回到咱们这个定义上来

大家会发现非常的有道理

这个长方体是什么

就是三个对面形成的交集

没问题吧

哎所以说这是这个事

是我们这么理解这个长方体的一个方式啊

这是有用

为什么呢

那么之后马上要输好吧

那么呃就是这么回事

### 00:59:21,50

![00-59-21](tmp/00-59-21.jpg)

嗯我们通常呃在这个嗯实际的应用中呢

我们为什么要引入这么个对面

这么个概念

叫轴对齐宝为和

然后这个缩写成 a a b b 啊

也就是说啊这个我们看这个长方体

它的任何一个轴

它都是沿着某一个这个这个这个坐标轴

就是 x 或者 y 或者 z

它不是某种任意旋转的

就比如说它形成的这个平面

它形成这种三个对面肯定都不是这个啊

xy 平面

y z 平面

z z x 平面

就是就是这种呃类型

就是它不是在空间中任意旋转

然后对应到这个二维情况啊

你可以认为是一个这个长方形

长方形它的边一定是横平竖直的

就是这么个意思啊

就是说只是定义说它不要让它任意的跑

就是说我们在实际中会很常用这种 aa bb 这种表示方式

这样的话我们就非常好的解释

对我们刚才已经提到说这样的话我们可以怎么理解呢

一个呃这个呃长方体我就可以理解成是给 x 范围内

就是 yz 平面两个不同的这个和 yz 平面平行的平面

再切出来的一个对面

然后然后这个呃他这中间的这个范围对吧

x 上面占据一定范围

y 中间占据一定范围

然后 z 在占据一定范围

然后我们就可以定义这个 a a b b

那这是我们这么一个用法

就是说那这个这样一来

我们这准备知识应该就已经说差不多了

那和里面的东西更不可能对吧

### 01:01:09,0

![01-01-09](tmp/01-01-09.jpg)

那咱们判定如如何判定这个光线和一个盒子

是不是这个这个有焦点呢

那这就是一个很重要的一个内容

好吧呃好吧

嗯

那今天看来是没办法了

这个我尽量快点吧

因为这块还是挺重要的

后面这个知识肯定都会用到这个这个呃光线和 a b b 求教好吧

那行啊

没问题啊

嗯这边我们先做一个简化对吧

我不知道光线和这个三维情况下

这个和这个这个盒子怎么求教

我先看二维的怎么来算对吧

通常情况下人们会愿意降低一些思维上的复杂度哈

然后很很简单的想法

那这个呃二维情况下

如果给你定义一个长方形对吧

是一个盒子

那怎么定义

怎么理解呢

还记得吧

理解成是那就是两个对面形成的这个交集

那么我们看 这个对面也就是我先说考虑这个 x0 和 x1 两条竖线

两条竖线

然后呃对于给定的一根光线对吧

给定任何一条光线

我可以求出来

这个光线在什么时候会和这两个这个树的这个无限大的这个面诶

有交点

那那我们现在可以可以可以看到啊

这个光线在这里往这个方向传播

那么它在这个地面时间呃

它就会这个和左边这这条竖线呃无限长的得到一个交点

然后呢这个在 tmax 时间我就会和右边这个面呃

形成一个这个这个焦点啊

这个没问题

挺简单的

那那我说那我看另外一个对面啊

另外一个对面两条水平的这个这个线

### 01:02:48,0

![01-02-48](tmp/01-02-48.jpg)

那两条水平的这个线呢

我同样可以求出这个光线在什么时候会和这个这个这个嗯

就是说某一个呃嗯直线有交点

然后什么时候和另外一条直线有交点

就是定义这个 y 上面这个范围 y0 y 一来大家会看到这个光线啊

他是不是从 o 传播往 d 这个去

那么它一定在某一个负的时间

然后他会和这个底下这个嗯面求得到交点

在某一个时间 t max 又可以和上面这个面得到一个焦点

对不对

这里呢就是说呃他大家会发现得出来了

一个这个不太合物理规律的一个这个 t 时间没关系

咱们先放在这儿好吧

先放在这儿

假设这个光线是直线

然后咱们马上最后最后再处理它是射线的情况

那就是说呃我对于任何一个对面哈

我都可以求出这个呃光线它的精确的时间和出去的时间

这个没问题啊

就是即便它是负没关系啊

就是比如说这里我知道哦

这个光线在拼命时间进入了这这个竖着的这个版嗯

然后两个板之间对吧

然后在 t max 之间出去了竖着的这个这个板

然后这个横着的这这这这一对板呢

我知道他的 tm 时间进来

在 t max 时间出去

那么我现在问这么一个问题

那么我知道这个光线什么时候进入

分别进入啊

这两对板什么时候分别出局这两对白

那么我如何得到这个光线在什么时候进入了这个盒子

以及在什么时候出血了这个盒子呢

那大家可以看到对于二维的情况

### 01:04:20,0

![01-04-20](tmp/01-04-20.jpg)

其实它是一个简单的这个这个看法对吧

就比如说这里大家当然知道啊

这个光线在这个时间实际进入了这个这个盒子对吧

长方体在这个 t max 时间实际出去了这个长方长方体

那这个要怎么理解呢

为什么说我得到了这么两个线段对吧

为什么我得到这么两个线段

那事实上来说我这条线段右边这条线段才是这个光线

实际这个在这个盒子里面的这个时间呢

就是从地面进入

从 t max 出去呢

大家会发现这是怎么做的呢

这两个线段实际上他求了一个线段的交集

大家可以看到为什么

因为这个盒子本身它是两个对面形成的交集

那么现在对于你这个光线来说

你分别和两个对面求出来它的这个这个输入呃

这个进进入和和这个呃这和和和出去的这个时间

那么这个我把这两个线段求一个交集

我就可以得到这个呃这个这个光线啊

实际进入和这个移出这么一个盒子的实践对吧

就是 tm 和 tmax 就这么做

就是说有这么两个这个这个线段的这个交集啊

我们求出来就可以

那么这到底是为什么对吧

这就是我们要思考的一个问题

而这个问题同样可以直接用逻辑性的事情来这个得到解决

那怎么解决呢

咱们直接看这个三维的情况好吧

怎么样去看这个这个光线到底和这个盒子是否相交

### 01:05:52,0

![01-05-52](tmp/01-05-52.jpg)

那么现在就是这么回事

从三维的情况下来考虑

三维的情况下

给一个盒子

其实就是这个三个对面

对不对

然后这个这里就是说我们这个最最重要的一个一个思想啊

就是说啊我们想这个光线什么时候

它才会算是进入了这个三维的情况下的一个盒子

那么我们自然的这个想法

就是只有当光线进入了所有的这些这个这个对面

就是有三个对面嘛

都这个三个对面都必须满足光线已经进去了

我们才能说这个光线进入了这个盒子对吧

是这么想

就是他是这个这样一个逻辑问题

那么我们说光线什么时候离开这个盒子呢

那就是说光线只要离开任意一对这个对面

这个光线就已经离开这个盒子对吧

这个就是说这么两个这个这个核心的这么一个呃一个一个一个观察啊

就是说这是这是逻辑上的一个事情

那么咱们立刻就可以得到一个这个算法出来了对吧

对于这个三维空间中了

我这个嗯有三个不同的对面对吧

就三个不同的这个这个这个呃三组嘛对吧

x y z 方向上

我个计算一次这个这个光线进入这个对面的最小时间和最大的时间

我们不管是正是负对吧

我就什么时候进入这个对面

什么时候离开这个对面

那根据我们之前考虑的这个这个观察的结果上来看啊

就是说我们什么时候才能说这个光线进入了这个盒子呢

它必须得进入所有的三个对面

我才认为光线进入了这个盒子

那也就是说我对于所有的进入时间听命三组啊

然后我求出它的最大值

这是最晚最晚光线进入进入最后一个对面的时间叫做 t enter

也就是这个光线真正进入这个盒子的世界

那么这个同样道理

光线什么时候会离开这个盒子呢

我们刚才分析的

只要光线离开任何一个对面

这个光线就已经离开这个盒子了

那是这么个理解

那什么时候光剑离开这个任任何一个对面呢

那就是最小的时间

他离开这个三个对面

还有三个不同时间

那求出最小的这个时间

那就是光线离开任意一个对面的时间

那这里就我们就通过这个这个思路分析啊

我们就明确地得出来好

光线在什么时候这个这个进入这个盒子

以及什么时候呃离开这个盒子对吧

那么这里大家也就可以明白说

为什么说我要把所有的进入时间都求一个最大值

以及这个离开的时间反而求一个最小值

这就是这个之前的两个这个逻辑造成的这么一个情况对吧

然后好

那没问题

那这样的话我知道光线什么时候进入盒子

什么时候离开盒子

那么什么时候有焦点呢

### 01:08:47,50

![01-08-47](tmp/01-08-47.jpg)

如果说进入的时间小于离开的时间

说明什么是什么问题

说明这个光线在这段时间内

它就在这个盒子里

所以它这个所谓 stays a while

就是就是说他他在这个盒子里面了一段时间

那当然这就是有焦点

反之就没有交点

很简单

就是相当于是我们求出三组

三组这个对面这个光线的这个进入和离开时间

然后分别求

然后然后在这个通过上面的逻辑

咱们把它求出这个光线呃

进入和离开这个盒子的世界

如果进入了时间

这个呃早于离开了时间

那这个光线势必要在这个盒子里待一段时间

那这就是有焦点没问题

但是到目前来来说

基本上来说是对的

但是呢这个还是有一些问题没有处理的

比如说我们一直没有考虑说这个负的值要怎么考虑

我们一直在考虑说一个其实是一条直线

和这个呃和这个呃一个盒子的求交点对吧

那咱们现在开始考虑说这个呃负的情况怎么考虑对吧

### 01:09:51,50

![01-09-51](tmp/01-09-51.jpg)

那么光线显然它不是一条直线

它是一个射线

那我们要检查这个时间 t 是不是正的或者负的对吧

然后然后就是这么个意思

那我们现在有两个时间 t 对吧

一个是进入这个盒子的时间

一个是离开这个盒子事件

那么说它这个进入盒子的时间

如果是呃呃是是这个意思啊

如果说光线离开这个盒子的时间是小于零

那说明什么问题呢

那说明这个盒子它一定在光线的背后这样想对吧

因为光线我们反向延长

然后我们才会发现这个 t 这个 exit 和这个 t enter 这个都小于这个呃

呃都小于零对吧

小于零的概念就是说在它背后就是光线离开这个盒子的时候

是在光线背后

那就说明这个盒子是在这个光线背后的

是不可能有交点的好

那这种情况咱们已经考虑清楚了

那如果这种情况不满足

那就是说当这个当这个离开的时间是正

那那这种情况下我们还要考虑正负

那这个时候就会出现说这个呃进入这个合作的时间

如果它是负的

会怎么样

对这种情况说明什么问题呢

这种情况其实这个也是一个很常见的情况

大家可以想象一下

就是说给你一个盒子

然后然后这时候我们不考虑什么对面什么东西了对吧

我们已经把这个进入和离开盒子的时间都是考虑清楚了

那如果说这个有一根光线诶

他穿过这个盒子

然后它自然可以找到一个这个呃进入的时间和离开的时间

两个都得是正的

那什么时候会出现离开的时间是正的

反而进入的时间是负的呢

那就只有一种情况

就是这个光线的起点就在这个盒子里

虽然这样讲

那么光线的起点如果在盒子里面的话

那他肯定是在一个正的时间离开这个盒子

而且在一个负的时间进入这个盒子

那这种情况光线在盒子里面

那么我要判断光线和盒子是否有交点

那这不是显而易见的

肯定有交点吗

因为这个光线一定在盒子里

不管往哪个方向去

肯定都要和这个盒子相交

所以这个时候一定有交点

那么咱们就把这个所有的正负情况都考虑清楚了哈

前提啊前提咱们刚才说了

在有交点的情况下

在刚才这个进入时间小于这个这个这个离开时间的时候

这说明光线在这个呃你这个盒子里面得到了一定时间的停留嘛对吧

这就是这个嗯有交点的情况

所以咱们总结起来好

总结起来光线和 aa bb 有交点

当且仅当啊

这里不是写错哈

这个是 if f

这个是指当前紧张的意思啊

当前紧张什么呢

非常简单的条件就是说当且仅当这个进入时间小于离开时间

并且离开时间大于等于零

这就可以离开时间是非负的

就是这样的话

我们就可以得到这个最后的结论

那么刚才这个怎么算这个进入时间和离开时间

咱们刚才上一页就已经说清楚了对吧

求最大的最小和最小的最大

这样听起来有点别扭

但是通过刚才那几个逻辑

就是说光线呃还是一样

回顾一下光线呃

要想判定他一定进入了这个盒子

那他必须得经过得得确认他进入了这个所有的三个对面

才能说他进入了这个盒子

而光线离开这个盒子

我只需要知道这个光线只要离开了任意一个对面

那他就已经离开了这个盒子

没问题吧

那行那就是这个逻辑是最重要的

这一块呢相对较难

然后回去这个可以体会一下好吧

然后就是说只要这个逻辑能想清楚我们为什么做这个 mean 和 max

这就肯定没有任何问题好吧

那么行

那这样一来呢

这个这个 ok 这一块就差不多了

然后呢有一些细节上的事情咱们处理一下

### 01:13:31,50

![01-13-31](tmp/01-13-31.jpg)

比如说我们说这个我们刚才提说要用 axis aligned bbox

就是横平竖直的对吧

然后为什么要这么做呢

是因为啊这个光线和这些这个和这些坐标轴啊

这个平行的这么些面

他求这个焦点好求

怎么求呢

比如说我们我们刚才说了

光线和一个平面求交

我们知道怎么求这个时间

我知道对没问题

但是其实这个计算挺复杂的对吧

那如果说这个光线本身啊

它和这个和这个这个就是说这个啊这个盒子

它的这个平面和这个轴什么东西都是平行的啊

这种情况就很简单

就是说咱们说这个嗯

比如这个对面哈

它是和 y z 平面平行

于是这两个都是垂直于 x 轴

所以咱们可以直接看 x 轴上的传播

那怎么做呢

就是说从这个 o 加上某个 t 乘以 d

它会和这个呃这个点呃得到一个交点对吧

嗯那么对于这种情况下来说

如果说我只看 x 轴方向的传播

其实就够了

怎么说呢

就是说我用这个 p 点的这个 x 啊

呃 x 坐标减去 o 点的 x 坐标

不就是这段距离嘛对吧

就这段距离我直接除以 d 这个方向在这个距离上的分量

然后这样的话我就可以直接立刻可以得到说这个在时间 t 呃

是是是是什么时候我可以这个认为光线打到了这么一个板啊

其实就是利用了一下

说我这个当这些轴嗯

当这些平面和这个呃各种各样轴垂直的时候

这些计算会相对容易一些

就是这个意思

大家可以看到这里这个计算量的对比

上面还要做点乘

下面直接用 x 分量就可以做出来了

多简单对吧

就是 x y z3 个分量咱们分别考虑就可以了

所以从这个角度上来说

我们为什么要用这个 a a b b 这么个概念啊

好那没问题

那么呃我觉得今天差不多就可以讲到这里

然后后面再会给大家再说这个更复杂一点的

这个呃不是说更复杂吧

到这里来说

对吧好

那么咱们今天就到这儿

哎呀抱歉

这是行吧

反正这个嗯这节课这个重要概念就是这个光线和这个不同物体的求交

特别是和这个 a a b b 的求交相对较难

如果大家发现这个理解上有些困难的话

没有关系

因为他本来就拿多花点时间去思考一下

这也是这个之后大家要实现的一个内容哈

这个嗯在作业里面啊

ok 那没问题啊

那今天咱们就说到这儿啊

咱们把时间交还给技术秘书同学

感谢大家的支持啊

### 01:16:19,50

![01-16-19](tmp/01-16-19.jpg)

好

ok 拜拜
