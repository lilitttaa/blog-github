---
title: C++ Primer 12.动态内存
---

## 内存概述

生命周期：

- 全局对象：程序启动时分配，程序结束时销毁
- 局部自动对象：进入块时分配，离开块时销毁
- 局部 static 对象：第一次使用时分配，程序结束时销毁
- 动态分配对象：显示控制分配和释放

内存空间：

- 静态内存：局部 static、类 static、任何定义在函数之外的对象
- 栈内存：函数内的非 static 对象
- 自由空间/堆内存：动态分配的对象

## 动态内存和智能指针

- 使用 new 分配内存
- 使用 delete 释放内存
- 动态分配内存容易出错：
  - 忘记释放内存
  - 释放后继续使用

为了避免这些问题，C++11 引入了智能指针：

- shared_ptr：多个指针指向同一对象
- unique_ptr：独占对象
- weak_ptr：shared_ptr 的伴随类，是一种弱引用，指向 shared_ptr 所管理的对象。

### shared_ptr

### 直接管理内存

### shared_ptr 和 new 结合使用

### 智能指针和异常

### unique_ptr

### weak_ptr

## 动态数组

### new 和数组

### allocator 类
