---
title: C++ Primer 6.函数
---

## 函数基础

### 编写函数

```cpp
int fact(int val) // 函数定义 val是形参
{
	int ret = 1;
	while (val > 1)
	{
		ret *= val--;
	}
	return ret;
}
int fact(int val); // 函数声明

int j = fact(5); // 函数调用 5是实参
```

函数定义最多只能有一个，而函数声明可以有多个。

### 函数调用的过程

- 函数的调用完成两项工作：
  - 用实参初始化函数对应的形参
  - 将控制权转移给被调用函数。此时，主调函数（calling function）的执行被暂时中断，被调函数(called function)开始执行。
- return 语句也完成两项工作：
  - 返回 return 语句中的值(如果有的话)
  - 将控制权从被调函数转移回主调函数。

### 实参和形参

尽管实参与形参存在对应关系，但是并没有规定实参的求值顺序

实参至少需要能够转换成形参的类型：

```cpp
int fact(int val);

fact("hello"); // 错误，const char* 不能转换成 int
fact(3.14); // 正确，3.14会被转换成3
fact(); // 实参数量不匹配
fact(1, 2); // 实参数量不匹配
```

```cpp
void f();
void f1(int a,b); // 错误，形参列表中每个形参都必须有一个类型说明符
void f2(void); // 正确，显示指定没有形参
void f3(int,int); // 正确，形参可以没有名字
void f4(int a,float a); // 错误，形参名字不能重复
```

### 返回值

- void 表示函数不返回任何值
- 数组类型和函数类型不能作为函数的返回类型，但是可以返回指向数组或函数的指针

### 局部对象

- 名字有作用域，对象有生命周期(lifetime)。
- 名字的作用域是程序文本的一部分，名字在其中可见。
- 对象的生命周期是程序执行过程中该对象存在的一段时间。

局部变量生命周期：

1. 自动对象：
   - 在块内定义的对象，当程序执行到定义处时创建，当块执行完毕时销毁。
   - 形参也是自动对象。
   - 局部变量如果没有被初始化，其值是未定义的。
2. 局部静态对象：
   - 在块内定义的 static 对象，只在第一次调用时初始化，直到整个程序结束才销毁。
   - 局部静态对象在程序的整个生命周期内都存在，但是只能在定义它的函数内访问。
   - 局部静态对象值如果没有被初始化，会执行值初始化，获取默认值。
   ```cpp
   void count_calls()
   {
   	static size_t ctr = 0;
   	cout << ctr << endl;
   	++ctr;
   }
   count_calls(); // 0
   count_calls(); // 1
   ```

### 函数声明

- 因为函数的声明不包含函数体，所以也就无须形参的名字。
- 函数声明应该放在头文件中，函数定义放在源文件中。

### 分离式编译

TODO

## 参数传递

函数形参可以有两种：

- 引用
- 值，指针也是一种值


### 传递引用

形参传递时非引用类型的顶层 const 会被忽略，以下两种定义是重复的：

```cpp
void f(const int i);
void f(int i);
```
