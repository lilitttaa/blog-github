---
title: Games101 18.Advanced Topics in Rendering
---

## Advanced Light Transport

![Alt text](image.png)

- vcm 结合了光子映射和和双向路径追踪
- 最后这个实时辐射度算法，相当于是把间接光表示成很多很小的光源

有偏和无偏分别是什么意思呢？
![Alt text](image-1.png)

- 这就涉及到了我们做光线追踪的很多方法都是用蒙特卡洛估计，有些蒙特估计方法是无偏的，有的是有偏的。
- 无偏是指蒙特卡洛估计时期望永远都是我们要的那个真实值，所有其他情况都是有偏的。
- 还有一种特殊情况，是指在样本少的时候估计是有偏的，但是如果样本数量趋近于无穷，那么这个估计值就会收敛到正确的值。这种情况我们还是认为是有偏的，但是我们称之为一致的。

### Birdirectional Path Tracing

![Alt text](image-2.png)

- 之前我们在路径追踪里边利用光路的可逆性从相机出发，然后打到光源，这样就形成了一条路径。而 BDPT 把这个概念扩展了，从相机和光源分别出发，打出一条半路径，然后把这两个半路径的端点连起来，这样就形成了一条完整的路径。
- 这个思想很简单，但是实现起来非常困难

![Alt text](image-3.png)

- 不过 BDPT 在某些情况下的效果非常好，比如看上边的情况，整个场景基本都是被间接光照亮的，我们如果从相机出发要想打到光源那块能量集中的区域是不太容易的，而从光源出发打到相机就容易很多，这种情况下 BDPT 就非常适合。
- 另外 BDPT 相对来说比较慢

### Metropolis Light Transport（MLT）

![Alt text](image-4.png)

- MLT 利用一个统计学上叫做马尔科夫链的工具，这个工具可以帮你采样。
- 之前我们使用蒙特卡洛每次选的样本和上一个样本毫无关系，每次用任意形状的 pdf 来采样。但什么样的形状最合适呢？跟你要积分的函数形状保持一致的时候最合适。
- 而马尔科夫链的思想是给定一个样本，然后生成一个跟它靠近的新样本。它就可以让样本的分布和被积函数的形状一致。
- 也就是说在 MLT 中，在给定一个路径的情况下，可以生成一个周围的路径。它是一个局部的方法，给你任何一条路径，它可以生成和这个路径相似的路径。
- 上图，这条蓝色的光路就是已经找到的路径，然后对这个路径做一些微小的扰动，就可以形成一条新的路径。通过不断地在周围产生新的路径，最后就可以生成所有的路径。

MLT 的优点：
![Alt text](image-5.png)

- MLT 很适合处理非常复杂的光路传播，比如下图中的场景，这个门半开着，光线只能从门的缝隙中进来，这种情况下 BDPT 就不太适合。

缺点：
![Alt text](image-6.png)

- MLT 的收敛速度在理论上很难分析，不知道它什么时候才能变得没有噪声。
- 并且它所有的操作都是局部的，这就意味着每个像素都是独立的，这样有些像素收敛的快，有些收敛的慢，最后得到的结果就是图像看上去很脏。所以它不太可能作为动画渲染的方法。

### Photon Mapping

![Alt text](image-7.png)

- 光子映射是一个有偏的估计
- 特别适合渲染所谓 caustics，就是光线经过聚焦后形成的图案

下面提一种光子映射的实现方法（实现方法很多）：
![Alt text](image-8.png)

- 第一步：从光源出发辐射光子，也就是正常的一个光线传播，碰到物体就反射或者折射，直到打到 diffuse 的物体上，然后停下来记录起来。
- 第二步：从相机出发，发出光线，同样到达 diffuse 的物体上，然后把这两步合起来做计算。

![Alt text](image-9.png)

- 需要计算局部密度估计，表面哪些位置应该亮，哪些位置不该亮呢？也就是周围的光子越集中的地方越亮，越不集中的地方越不亮。
- 密度估计的做法就是找到周围最近的 n 个光子，然后计算这些光子占据的面积，然后计算光子的密度，是一个最近邻问题。

![Alt text](image-10.png)

- 然后涉及到一个 n 取多少的问题，如果 n 取的太少，就会有很多噪声，如果 n 取的太多，就会很模糊。为什么 n 取得太多会模糊呢？因为密度实际上我们应该取一个无限小的面积，但是我们取的是一个有限的面积，除非我们光子打的无限多，否则我们得到的结果都是有偏的。

![Alt text](image-11.png)

- 所谓有偏和无偏，如果结果有任何一点模糊那么它就是有偏的。
- 而如果样本足够多它的结果会收敛到一个不模糊的结果，那么它就是一致的。

### Vertex Connection and Merging (VCM)

![Alt text](image-12.png)

- 相当于把 BDPT 和光子映射结合起来，在 BDPT 的两条 Pass 中间的端点很接近在同一面上（同一面上也意味着不会弹过去相连），这种情况不要浪费，虽然不认为是一条光路，但是认为是一个光子，然后用光子映射把这部分的光路的贡献也给结合在一块。
- VCM 的应用比较广泛，很多电影都是用这种方法来做的。

### Instant Radiosity（IR）

![Alt text](image-19.png)

- 因为我们不太区分光线是反射来的还是自己发出来的，所以我们可以把已经被照亮的点当作光源，然后用这些光源来照亮别的点。IR 利用的也就是这样的思想。
- 一开始先从这个光源打出很多的 light subpass，然后它会停在某些地方，然后认为这些地方就是新的光源（VPL），然后用这些新的光源来照亮别的点。
- 对于多光源的渲染是一个非常活跃的领域。

![Alt text](image-20.png)

- 好处是实际应用起来非常快
- 但是存在问题，比如有些地方会莫名其妙的发光，这是跟距离的平方项有关系，之前我们推导 light sampling 时把立体角的采样改为对面积的采样，然后会出现面积除以距离，如果两点之间距离很近，就会出现除以一个接近零的数，得到一个很大的结果，就会出现这种情况。
- 不能做 glossy 的物体

### Question

Photon Mapping 中的面积怎么定义？

- 其实是挺 hack 的一个做法，可以把这些光子求包围球，然后把这个包围球和着色点所在的面求交集，得到这个相交的面的面积。这块也有很多各种各样不同的方法。

有没有完美的方法？

- 目前来说没有，工业界现在很多厉害的公司还在用 path tracing，因为它是最可靠的一个方法。

## Advanced Appearance Modeling

![Alt text](image-13.png)

- Participating media（散射介质）：例如雾、云、烟等，这些材质不是在一个表面上，而是定义在空间中。

### Non-Surface Models

#### Participating media

![Alt text](image-14.png)
![Alt text](image-15.png)

![Alt text](image-16.png)

- 光在行进过程中可能会发生：
  - 云中间有光源，它本身会发光，这个先不考虑
  - 云里面有各种晶体，光线会被随机打到其他方向上
  - 也可能有光线从其他方向散射过来
  - 在传播过程中，有些能量会逐渐被吸收，比如乌云
- 最重要的就是两样事情，第一被吸收，第二被散射

![Alt text](image-17.png)

- 类比物体表面，对于散射介质来说也一样，任何一个点都会发生散射，往各个不同的方向散射，由 Phase Function 这个相位函数（很像 BRDF）来定义。

![Alt text](image-18.png)

- 找到整个路径过后计算它的贡献，不过这里用的就不是 rendering equation 了，因为它考虑的是表面的的作用，这里是体积，但是思想是一样的。

下面是一些应用：
![Alt text](image-21.png)
![Alt text](image-22.png)

- 很多材质看上去可能以为是个表面的东西，但实际上不是，光线是可能进到物体里的，只是说进的多还是少。

#### Hair / fur / fiber (BCSDF)

![Alt text](image-23.png)

- 头发也不是定义在表面上的，因为很多头发都是飘出来的，所以要考虑光线和曲线如何作用，不再是和一个面如何作用。
- 另外头发有高光，一种是无色的高光，一种是有色的高光。

下面我们来分析一下头发的两种高光是怎么产生的

Kajiya-Kay Model：
![Alt text](image-24.png)

- 这是一个类似于 Blinn-Phong 一样的简单模型，它把头发近似为一个圆柱，然后光线打到圆柱上会散射出一个圆锥，同时也会有一些光线被散射到四面八方，就好像是 diffuse 和 specular 两个加起来。

然后就能得到这样的效果：
![Alt text](image-25.png)

- 看上去自然是不对的。

下面介绍一个广泛应用的模型，Marshine Model：
![Alt text](image-26.png)

- 把反射定义为 R，把穿透定义为 T，那么一根光线打到头发上会有三种情况：
  - 一种是直接反射，记作 R
  - 一种是穿进去再穿出来，记作 TT
  - 一种是穿进去，然后在内壁上反射，再穿出来，记作 TRT

![Alt text](image-27.png)

- 头发内部有色素，如果有光线穿进头发，在传播的过程中会被部分吸收。

![Alt text](image-28.png)

- 这个模型可以得到很好的效果
- 这是跟一根头发怎么进行作用，如果是多根头发，光线会不断地进行弹射，最后才能得到结果，所以头发的渲染计算量是非常大的。

头发渲染的一些应用：
![Alt text](image-29.png)
![Alt text](image-30.png)

![Alt text](image-31.png)

- 但是这个模型用在动物上会发现表现不太好

![Alt text](image-32.png)

- 从生物结构上发现，人和动物的毛发结构是一样的，都是三层外面是 Cuticle（表皮），中间是 Cortex（皮质），最里面是 Medulla（髓质）。
- 最里层的 Medulla 是一个很复杂的结构，光线进去之后会好像进入了散射介质一样，直接被打到四面八方去。
- 对于动物来说，它们的 Medulla 比较大，光线进去之后更容易发生散射，所以我们不能忽略这个结构。

![Alt text](image-33.png)
![Alt text](image-34.png)

- 可以看到 Medulla 的作用还是很大的，看上去要亮很多。

Double Cylinder Model：
![Alt text](image-35.png)

- 用两个圆柱来模拟髓质的作用

![Alt text](image-36.png)

- 光线可能穿过髓质也可能没有穿过髓质或者穿过了但是没有被散射到四面八方，因此对于 TT 和 TRT 有两种可能，被髓质散射的光线我们记作 TTs 和 TRTs。

![Alt text](image-37.png)

- 这样我们用五个分量来表示

![Alt text](image-38.png)

- 这个仓鼠一帧渲染了 40 分钟

这个模型得到了广泛的应用：
![Alt text](image-39.png)
![Alt text](image-40.png)

图形学看上去是什么都涉及，之前涉及到数学、物理、统计，现在又涉及到生物。

#### Granular Material

![Alt text](image-41.png)

- 也就是一粒一粒的这种模型，例如：盐、糖等

![Alt text](image-42.png)

- 这个计算量非常大
- 可以简化为每个单元上有不同的石子构成，各自成分都是百分之多少，然后渲染
- 这种材质目前并没有得到一个非常好的解决

![Alt text](image-43.png)
![Alt text](image-44.png)

### Surface Models

![Alt text](image-45.png)
![Alt text](image-46.png)
- 玉石、水母这样的Translucent材质，光线可以从一个地方进入，然后散射到其他方向上去。

![Alt text](image-47.png)
- 这样的现象叫做 Subsurface Scattering（次表面散射），这个现象在很多物体上都会出现，比如牛奶、人的耳朵等。

Scattering Functions：
![Alt text](image-48.png)
- 看作是对BRDF的延申，在BRDF中我们认为光线进来后往不同方向去都发生在一个点上，但BSSRDF中光线可以以不同方向和不同位置出去。
- 原本某个点的出射光线只需要考虑这个点的入射，现在还要考虑其他点的入射。
- 因此渲染方程也要改一改，原本是对各个各个方向进行积分，现在不仅要对各个方向进行积分，还要对面积进行积分。

Dipole Approximation [Jensen et al. 2001]：
![Alt text](image-49.png)

那么人们就发现啊

其实怎么说呢

比如说大家自己可以试一试啊

把这个手机摁在手上

手心上啊

然后打开这个这个闪光灯

大家会发现这个闪光灯周围就好像说产生了一片

这个往外走的这个光源一样

就好像是你的手心底下有一个光源在发光一样

诶这里就是这个这个这个这个基本思想

人们会发现啊

这半透明介质就好像这么一个原理一样

我有一根光 a 一光线打到了一个什么物体上

就好像这个物体底下出现了一个光源

然后呢这个会从底下照亮我周围的这个打打的这个着色点

周围的一片诶

这种情况就就就非常好

当然为了物理上的真实哈

物理上的真实

就大家推出来说

这一个光源不够

还得是对应上方也得有一个光源

所以相当于是有两个光源

然后用这两个光源去照亮周围着色脸

这一块就很像次表面散射得出来的结果

好吧

这样想

那么这个这样理解的话呢

呃就差不多了

好吧

就是用这个大 ipo 方法

就是这两个这个光源嘛叫大 ipo

然后呃用这种方法来近似这个次表面反射散射的这个效果

那当然得出来的结果不错

### 01:05:22,93

![01-05-22](tmp/01-05-22.jpg)

为什么说不错呢

咱们看这个呃

这是一个雕塑对吧

呃然后这个呃假设它的渲染都是 b2 df 对吧

都是 b2 df

没有次表面散射

那看上去就是大理石啊

不是大理石啊

就相当于是这个这个石膏一样这种这种效果啊

那如果有这个四表面散射呢

大家会发现诶效果就完全不一样

### 01:05:41,93

![01-05-41](tmp/01-05-41.jpg)

就完全看上去像是这个这个大理石这种效果了

就是光线在哪看的比较明显的

在这个鼻子这啊

我现在切回去啊

b2 df

### 01:05:51,43

![01-05-51](tmp/01-05-51.jpg)

那当然这个鼻子背后有光的

这个正面照不到光的

就完全是这个阴影了

那如果有 b s s r d f

### 01:05:57,66

![01-05-57](tmp/01-05-57.jpg)

大家看的非常明显的光线

就可以钻出去对吧

这样就可以得到一种就是看起来所谓珠圆玉润

就是这么一个效果对吧

那两面反射非常有用的东西

然后这里呢渲染正是用这个呃

就是打 ile 这么一个估计来近似的好吧

那么这是一个同样的另外一个例子

### 01:06:13,23

![01-06-13](tmp/01-06-13.jpg)

咱们看如果说用这个 b2 df 来渲染人脸

得到结果看起来很干对吧

那如果说我去用 b s s r d f 加入次表面散射渲染同一个人脸

### 01:06:20,40

![01-06-20](tmp/01-06-20.jpg)

那我就发现哎结果呢好的太多了

对不对

这就已经很像真实的人脸了

那同样的道理

为什么说它真实了些呢

那就是因为他这个在实际的情况下

光线它就是能进入人的皮肤

在这个一个局部这个散射出去对吧

那所以说他这个人的皮肤真的就应该有这个次表面反射散射的静止

所以说这个加入的时候自然效果会好啊

没问题

那么四条边弹射在这个科研上也有各种各样的应用

### 01:06:47,50

![01-06-47](tmp/01-06-47.jpg)

比如说这里是我这个当年我的老师的作品啊

呃徐坤老师的作品

然后他做过这个这个嗯这个次表面散射材质的编辑啊

就是你可以动态的改

### 01:07:02,13

![01-07-02](tmp/01-07-02.jpg)

比如改的更像石头啊

然后或者是改得更像玉石

然后颜色也可以变

然后这个或者更像蜡烛对吧

然后像这些东西都是可以调的

然后所以这个这个挺有意思的事情啊

### 01:07:12,10

![01-07-12](tmp/01-07-12.jpg)

就是说对于 b s s r d f 给大家这个这个说一下

就是说大家现在研究的还是这个非常非常不错的啊

有很多人喜欢这个

我自己也很喜欢啊

然后 bs d f 有多么厉害

### 01:07:24,40

![01-07-24](tmp/01-07-24.jpg)

但是厉害到了一定境界哈

大家看这三幅图

这三幅图有一个什么共同点能告诉我们

我直接告诉大家吧

好吧

这个三幅图都是假的

这三幅图的渲染都都是渲染来的

没有一副是这个真实的照片啊

然后就是说这个大家看看这三幅图觉得好

现在这个是真的厉害对吧

就是真的皮肤这块

然后这个大家如果用了这个次表面散射之后

会得到非常非常真实的皮肤对吧

然后这个效果就非常非常好

然后呢这里还给大家推荐一个网站啊

这个叫什么呃

这个这个地址大家没事看一看

说是十个这个这个这个就是渲染的最真实的嗯人物模型

然后你可以可以看看这个大家这个艺术家是有多么厉害

以及现在这个四表面散射到底有多么强大

当然了

即便如此

有同学可能会说这个确实看上去还差那么一点点对吧

至少左边这个这个看起来还稍微差一点点啊

ok 啊好没问题

那么呃这就是留个后话吧

好吧

### 01:08:27,16

![01-08-27](tmp/01-08-27.jpg)

那这里再继续给大家说

那么我们说完次表面散射呢

我们再来说另外一个这个也是跟表面相关的材质

这个材质是什么呢

布料啊

就是 cloth

那么为了理解这个布料啊

我们得先理解他的这个制作原理

那布料是怎么来的啊

布料是一系列缠绕的这个呃纤维构成的

这样说没问题

但是它的缠绕啊

它有几个不同的层级

这个我给大家说一说啊

然后就是说这个这里涉及到很多概念什么呢

我们就说这个纤维是最原始的概念

一根一根那个就是最原始的时候

你用羊毛那一根羊毛

那就就是这个就是就是它的最基础的这个纤维啊

化纤也是一个道理

那么这个这个不同的这个这个这个 fiber 啊

就是纤维经过第一次缠绕

可以缠绕成不同的鼓

什么叫鼓

就是这个 ly poly 就叫鼓啊

然后这个这个不同的股再经过不同这个这个缠绕会形成线

那线就是一二

大家会看到这每一根啊

这个颜色它都是一个这个一股

它本身就是有很多的纤维绕成的

而这第一层缠绕

第二层缠绕很多骨绕一块会形成线

线本身也是涉及到这个这个各种各样不同的这个这个呃缠绕

好吧啊

这个 fibre 缠绕形成 play play 缠绕形成第二

然后第二之后就有了线之后要么被支撑

要么被这个呃得这这两个词中文反正都是知啊

我说的一个是这种

比如说这个机器这个一根压一根

这种算是这种这种这个桌布啊之类这种东西的做法啊

还有一种是你手工织的

跟打毛衣一个道理啊

就是这种

但是道理是一样的

没什么问题好吧

就是说我们把这个不理解清楚

不是由各种各样不同的这个所谓纤维缠绕而成的

这样就对了好吧

那么对于这种布来说

### 01:10:18,20

![01-10-18](tmp/01-10-18.jpg)

它既然是缠绕而成的

那如果要算它的这个表面模型

他就会非常非常头疼

这个这个因为什么呢

他肯定和你的这个针织啊

或者说这个纺织啊这种方向的有关

就跟你织出来的这种

比如说你隔多少根及另外一根去压着一根

这这这种织法有关

就是和你织出来的这种形状有关系

诶那这个就是说根据这种形状

我就可以来定义这个你得出来的这个最后的结果他会怎么样

如果我认为这个布料它就是一个物体表面的话啊

然后我可以通过这个各种各样不同的这个这个所谓编织的这个图案

我就可以来窜出来

它到底应该是得出来是什么样子好吧

那这自然而然我们就得到了一个 b2 df 的模型

那当然了

有同学会说这个这个这个 b2 dm 模型肯定有问题吧对吧

### 01:11:03,20

![01-11-03](tmp/01-11-03.jpg)

那如果说我这个布它本身真的是在一个平面上

我认为他是在表面上行

没问题

咱们之前见过他对吧

然后然后这个我之前提到说有个材质叫天鹅绒

天鹅绒这种东西

它所有的纤维它往外这个都是往外一根一根一根这个这个分布的对吧

根本它就不是一个平面

那我怎么能拿 b2 df 来表示它呢

其实并不合理

对不对

那所以说一个更准确的做法

### 01:11:28,90

![01-11-28](tmp/01-11-28.jpg)

那就是说这个我们把这个织物啊给认为是在空间中分布的体积

然后光纤中分布体积

我就可以把它划分成超级细小的格子

比如说大家看到左边那个围巾

然后呢右边这个沙发的这个这个这个布

它就相当于是把这个空间分成了非常非常小的这种格子

每一个格子里面诶

我大概知道他的这些这个纤维它的已经大概朝向分布呀

然后它的复杂程度呀是这些东西

那么我就可以把这些性质给转换成这个光线的这个吸收和散射

这样的话我就好像是在渲染云一样

我把这个性质啊

把它的性质给转换成这个这个嗯

就是对这个呃语音烟雾这种散射介质的渲染诶

我不再把这个布料当成是这个什么物

把把当成一个面了啊

我把它当成是一个体积

然后体积中间的任何一个微小的块我都知道它的性质

这么做

那当然大家可想而知

这个计算量是很夸张的

对不对

这是确实是这么回事啊

这生成一幅涂掉要花好多好多个小时啊

然后就是说呃当然能够得到相对准确的结果

肯定比你认为它在一个平面上这样对对吧

那所以说这个又是一次大家体会这个事情啊

就是渲染中间有很多这种所谓 trade off

就是你要想要更好的结果行没问题

多花点计算量

多花点时间对吧

那么我们说这是一个办法

能能够把这个这个布料啊当成散射介质来做

还有怎么做呢

### 01:12:52,83

![01-12-52](tmp/01-12-52.jpg)

那因为这个布料本身它可它就是纤维对吧

那我知道它是纤维怎么样缠绕的

那我自然而然

那我就说一个最暴力的做法

我把每一根这个纤维我都给渲染出来

不就完了吗对吧

那比如说像左边这一幅

大家可以看到哦

每一股对吧

这里不是鼓了

这每一个省

每一个这个县啊

样儿上面它都有很多的这个这个不同的这个 play

上面有很多不同的这个这个版本

那么每一根 fiber 我都渲染出来

就把它当成人的头发对吧

把当人头发渲染一模一样

那么得到的结果自然而然得到了非常真实的结果

没有问题

但是同样这个计算量也是非常非常惊人的

那么直到今天这个这三种方法啊

就是三种渲染这个布料的方法都有人用

好吧

就是说把它当成这个散射介质

当成实际的这个纤维以及当成是物体表面都有人用

而且这个考虑到各种各样不同的这个应用场合

如果你要更准确的结果

那就去多花点时间啊

大概这个布料我们就说到这儿好吧

不料呢给大家看一个某个看一个这个例子

### 01:13:54,96

![01-13-54](tmp/01-13-54.jpg)

ok 啊大家可以看到这个布料呢

### 01:14:01,20

![01-14-01](tmp/01-14-01.jpg)

显然就是不是在这个不是当物体表面算的啊

就是它本身会非常复杂

ok 然后这里呢是一个电影

### 01:14:09,30

![01-14-09](tmp/01-14-09.jpg)

这个电影本身呢并不是多知名迪士尼的

然后叫做这个 big friendly giant

然后说一些巨人的故事啊

然后他们身上穿的这种亚麻的衣服

然后做的非常真实

然后嗯就是说这个布料嘛当然会被应用在各个方面哦

这里多说一句

这个布料用的就是这个 b r d f 的模型啊

然后最简单的这个模型啊

但是其实效果也不错

对吧好

那么这里呢这个再给大家说下面一种材质

### 01:14:33,43

![01-14-33](tmp/01-14-33.jpg)

这种材质呢就是一种这个复杂的材质哦

说起来是这么回事啊

就今天这个课我就随意说了

然后就是说有同学想随时撤就随时撤吧

没什么问题啊

就是说本来这个就给大家这个随便说一说

作为这个这个这个这个呃扩展一下视野啊

那我这个继续往后说啊

那么这个复杂的这个嗯有细节的材质到底是怎么回事呢

对吧

那我们先看这个例子啊

就是说我们看这个现现金的这些渲染器渲染出来的一些结果

那其实看上去非常不错

这是一第二是其实还显得并不是多么真实啊

这个为什么不真实呢

对吧

是因为很多情况下得出的结果过于完美

你比如说像这个车子哪有现实生活中哪有这么完美的这么一块

这样这样这样的这个这个车子

任何的再次自行车对吧

上面都有各种各样的不同的划痕

不同的这些这些东西

这个鼠标现在看上去完完全全是整板一块对吧

然后得到的结果非常完美

反而这样就不对了

为什么真实情况下确实不会有这种情况

### 01:15:35,73

![01-15-35](tmp/01-15-35.jpg)

大家现在看到是真实的世界啊

就是说这个真实的世界里面呢

大家会看到这个车子上面会有这个高光

高光周围有类似这种蜘蛛网结构的这种东西

这种东西就是这个划痕

划痕发生在哪儿

发生在这个空气中

各种各样不同的这些灰尘颗粒和你的这个车外层的那层清漆之间

还没到那个车的这个油漆部分啊

然后就会有这种现象出现

所以在强光照射下一定可以看到这个效果

### 01:16:02,20

![01-16-02](tmp/01-16-02.jpg)

也可以看到这个是有一个高光不错

这种形成的高光诶

这个总共这个构成本对吧

所以说呢这些并不是什么这个特别这个这个呃光滑的一些东西

所以说真实世界反倒是不完美的

但是我们的这个这个描述方法呢确实能够得到一些很完美的结果

### 01:16:21,20

![01-16-21](tmp/01-16-21.jpg)

这是什么

这是那个呃微表面模型啊

microphysmodel

我们之前说过他非常强大

比如说结果非常完美

### 01:16:29,76

![01-16-29](tmp/01-16-29.jpg)

但是之前看那个摩托车也是这么回事对吧

但是呢这不真实

什么是真实的呢

这个是稍微真实一点

这个是这个是说这个呃我们加入了各种各样不同的这种

这种呃实际可能产生了一些不完美的地方

比如说像这个这个划痕这些东西

大家看到这个有划痕的情况下

旋转起来是可以看到高光还是高光对吧

但是你还可以看到各个不同的这种划痕

### 01:16:53,90

![01-16-53](tmp/01-16-53.jpg)

这一第二呢你甚至也可以去模拟这个这个是什么呢

### 01:16:55,46

![01-16-55](tmp/01-16-55.jpg)

就是物体表面了

然后这个一这个我刷过的这个这个呃所谓各项异性的材质还记得吧

我沿着一个方向去刷这个物体这个金属的表面嘛

然后大家可以看到这一条一条刷出来的这个划痕都在

所以你能够看到这个很明显的这个高光

### 01:17:13,83

![01-17-13](tmp/01-17-13.jpg)

它随着你的视角你可以看到不同的这种划痕

对吧

那像这种情况

那就是这个这个细节的模型能够给大家带来的真实感

### 01:17:23,80

![01-17-23](tmp/01-17-23.jpg)

那这个就是说我们为什么要研究它啊

诶大家有同学就发现了啊

是这是我的作品啊

算是代表作啊

### 01:17:30,50

![01-17-30](tmp/01-17-30.jpg)

应该是说是这博士中间的这几年我的这个呃几个贡献之一吧

就是这个这个这个细节的这个渲染是一个萌发的模型

是一个呃 real time retracing

是一个嗯差不多就这么几个哈

然后这个啊那我们就接着说啊

就是说这个微表面模型咱们之前提过对吧

微表面模型说最重要的是什么呢

是它这些微表面的这个反向分布对吧

但是我们之前提到的是不是就就就说到这儿啊

但是我们说这个分布上啊

实际上来说大家应该是这个嗯

怎么说呢

就是说大家描述这个分布

他用的是一些非常简单的一些一些模型

比如说我们用一个什么正态分布啊

高斯啊之类的东西去去描述它

那我用一个这个这个这种分布去描述这个法线的分布

### 01:18:16,60

![01-18-16](tmp/01-18-16.jpg)

那么得到的自然而然是一个这个看上去并没有什么细节的结果对吧

因为它反向分布本身我就没有体现出各种各样不同的变化

各种各样的细节

但是其实我们要的是它这个这个法线的分布啊

它基本符合这个这个统计规律

但它又有自己带的这个细节

那如果我们能把这些考虑进去

那自然而然就可以得到这个这个呃好一点的结果

比如说像这里大家看到这个蜗牛啊

在这蜗牛的壳上

### 01:18:44,0

![01-18-44](tmp/01-18-44.jpg)

### 01:18:44,63

![01-18-44](tmp/01-18-44.jpg)

我们贴了一个非常大的这个这个呃这个呃所谓法线贴图啊

之前咱们说这个纹理映射的时候

我们说过这个事情可以定义每一个点上它不同的法线

那么用了多大的反思法线贴图呢

200k 乘 200k 大家自己算一算一算

这是什么概念啊

这个这个是超级大的一个行业

贴图贴上去之后

那每一个面它可以产生一个高光

所有的高光形成在一块就会变成这么一个大的高光啊

那么如果这个大家从远到近可以看到这个 a

### 01:19:14,10

![01-19-14](tmp/01-19-14.jpg)

可以看到每一个高光都是什么样的对吧

那就是说确实一个大的高光是有很多高光形成的

### 01:19:21,53

![01-19-21](tmp/01-19-21.jpg)

那么同样我们可以换另外一种模型对吧

不同的这种法线

比如说像这里就在模拟这个车子

大家知道这个车子大家有很多人愿意在这个车子里面加呃

不是车子车子的这个喷漆里面加亮片

这个亮片非常非常小

但是它就会形成一个一个的这种不同的这个方向

### 01:19:38,66

![01-19-38](tmp/01-19-38.jpg)

不同的方向它就有就有不同的这种反光

得出来的效果就应该是这样的啊

然后所以说会得到这个非常真实的结果啊

ok 好

那么这里呢这个虽然我们可以定义各种各样不同的细节

### 01:19:47,23

![01-19-47](tmp/01-19-47.jpg)

但是渲染出来他们非常困难

比如说大家看到我真的用 pass tracing 来做哈

要多久要多久

比如说花了两个小时之后还得不到这个结果

这个结果咱们认为是这个药的结果哈

然后两个小时之内和开得不到这个结果

那多久可以得到呢

我算了一下这个时间啊

需要大概将近一个月

然后就是渲染渲染在那一个月能够得到这么一个结果好吧

所以大家可以想象这是一个多么困难的渲染问题

那么它到底困难在哪儿

### 01:20:18,53

![01-20-18](tmp/01-20-18.jpg)

那么这个根本原因在于我们认为这个微表面啊

每一个小的微表面是一个镜面

那既然是镜面

那咱们如果想象是一个这个呃这个这个呃针孔摄像机

然后和一个点光源的话

那么我从摄像机打一根光线过去

我打到了什么样的表面

然后我就知道它的法线

我就知道它镜面反射方向是什么

那我就很难很难很难通过反射的方式

让这根光线反射的光线打到这个光源上去啊

这就是为什么它难

然后这个光源打过来也是一样

它这个达到了一个微表面呃

知道怎么反射

但它就是反射不到这个这个呃这个摄像机上去

那所以怎么做呢

### 01:20:55,60

![01-20-55](tmp/01-20-55.jpg)

所以这里考虑就是说这个考虑一个像素啊

它会覆盖很多的这个微表面唉

如果我们能够把这个微表面的分布给拿出来

就是把这个在一个小的范围内

它的微表面的法线分布算出来诶

那这样的话我就可以替代原本的这个光滑的这个分布

然后并且用在这个微表面模型里

像这里大家应该听懂都没有问题

### 01:21:16,46

![01-21-16](tmp/01-21-16.jpg)

然后呢这里这个嗯我如果考虑说一个像素它覆盖了多大的这个范围

那会得到各种各样神奇的这个这个反向分布啊

ndf

然后就是说如果大家想想这个一个像素覆盖了非常多的微表面

那这些微表面自然而然就会显示出来一些统计学的规律对吧

这看上去就挺圆的

就很像是这个这个高斯分布对吧

那如果说这个覆盖的范围小

它就会显示出来一些很独特的一些性质

就是说它这个反向分布看上去就很很这个有特点

而且呢不同这个类型的这种反应分布啊

### 01:21:46,83

![01-21-46](tmp/01-21-46.jpg)

不同类型的这个这个呃这个法线呃贴图啊

然后会引起不同的法线分布

比如说像这种刷过的

那很显然会得到一系列这个叫做呃各项异性的这个这个分布

比如说像这种离散的这些亮片

每一个这个这个这个亮片都是一些离散的这个发现

那所以我就会得到很多离散的点哎

这就非常有意思对吧

那所以说我们只要能把它算出来就行了

当然这里就不给大家说怎么算出来

给大家多少看一看这个得出的结果就好

这是一个这个这个嗯这种模型啊

这个叫什么来着

### 01:22:23,73

![01-22-23](tmp/01-22-23.jpg)

就是 blender

就是一个一个杯子吧

水杯还有一个金属的这个表面

它一看到这里是一个磨过的对吧

### 01:22:27,16

![01-22-27](tmp/01-22-27.jpg)

这里是向这个方向磨的

跟橘子皮一样

然后这些都算进去之后

得到的结果就就能够把这些细节都给反反映出来

并且呢大家可以看到同样道理哈

任何的这些这些呃宏观的东西都一定是由这些微观的东西构成的

### 01:22:43,20

![01-22-43](tmp/01-22-43.jpg)

没问题吧

然后这样我们就可以看出来这是一系列的这个这个这个怎么说呢

一系列的点形成了这种现状的高光啊

ok 那么其实来说啊

之前我给大家说过这个事情对吧

就是说我们看一个卫星图是不是拍摄一个地球

### 01:23:02,20

![01-23-02](tmp/01-23-02.jpg)

那这个远和近微观和宏观是相对的

那如果我们从远处看一个海面

那我可以认为海面的这个这个波纹对吧

它这个是一个很细节的这些东西

那我也可以通过这种方式把它描述出来

### 01:23:13,10

![01-23-13](tmp/01-23-13.jpg)

描述出来之后呢

我每一帧用一个不同的细节

那就可以得出这个这个这个海面上的这些所谓波光粼粼这种效果啊

### 01:23:23,6

![01-23-23](tmp/01-23-23.jpg)

对吧

就是这个意思对吧

那这样一来就可以得到这么一个效果

然后呢同样道理

这个方法呢也在游戏中稍微得到了一些应用

### 01:23:29,76

![01-23-29](tmp/01-23-29.jpg)

就是像这里大家看到这个古墓丽影这个三部曲之二吧

我记得是

然后大家看这个雪地啊

雪地大家会看到这个这个位置

待会我会看的更明显一些

然后会有一些这个嗯嗯这些发光点对吧

### 01:23:42,6

![01-23-42](tmp/01-23-42.jpg)

当然这里是在实时渲染中的一些应用好吧

然后这里一个 ok 那么这个这里在这个把这这怎么说呢

### 01:23:52,3

![01-23-52](tmp/01-23-52.jpg)

就是说这些细节就算是这么解决了吗

答案是不对

为什么呢

是因为当你引入这些细节的时候啊

其实如果大家还在用这个几何光学来解释就不对

大家这个之前学过物理

这个物理上说什么呢

这个物理上说啊

这个这个这个啊就是说当这个物体啊非常小的时候

小到什么程度呢

小到和这个光光线的这个波长相当的时候

你就不能再假设光线的传播是沿沿着一个直线传播了

你就得必须假设这个光是一个波对吧

因为会试着叠到各种各样的现象

发生什么衍射干涉这种现象发生

那这种现象在这种这种微型的这种细节上就会发生

那么有很多人研究过这个问题

然后这个大家看到这些各种各样不同的效果

然后当然了

### 01:24:42,80

![01-24-42](tmp/01-24-42.jpg)

我也研究过这个问题

然后这个这个问题是反映在什么上呢

比如说你在一个小黑屋里面

真得小黑屋啊

其他光源都得关掉

就只能用一个这个点光源

比如说你手机的光去照亮一个就是金属片

你会发现金属片上金属原本是一个原则

但是你却在这个上面会看到各种各样不同的颜色

同样道理

### 01:25:01,33

![01-25-01](tmp/01-25-01.jpg)

你比如说拍这个

我有一个 macbook

我拍他的背后哎

我拍出来之后通常是白的对吧

但事实上如果我就用一个光源

然后我放大你能拍出来一张图

然后放大我又看到其实根本不是白的

是各种各样不同的这个颜色的点对吧

诶那这样的话呢

这个这这这就反映什么问题啊

既然我用白光来照射一个物体

它就反射出来就应该是白的

如果不是白的

一定有波动

光学发生了对吧

那所以说我们就把这个波动光学给解出来了

### 01:25:27,3

![01-25-27](tmp/01-25-27.jpg)

我就就说到这儿

波动光学的公式我完全不想提

我的天

我觉得这个完全是劝退的东西

这个太复杂了

这是在在这个叫什么这个复数域上做各种各样的基本啊

这个非常麻烦啊

不多说啊

大家就看什么呢

看到说波动光学得出的 b r d f 啊

跟几何光学得出的 b r d f 挺像的哈

但是又有自己的特点

什么特点不连续的这些特点为什么会不连续呢

大家学过物理

知道这个光会发生干涉对吧

光干涉会引起有一些地方加强

有些地方减弱诶

它就会形成这么一条一条这种这种不连续的效果诶

然后我们拿这个东西过去渲染啊

### 01:26:06,43

![01-26-06](tmp/01-26-06.jpg)

说渲染大家看到这幅图

这个真的是渲染出来的

然后这个这个并不是这个照片啊

然后我把它拿去渲染

并且用这个所谓的波动光学

然后大家可以看到在我这个放大的过程中放大放大再再再放大

### 01:26:22,93

![01-26-22](tmp/01-26-22.jpg)

放大到这儿

大家就会发现真的是这样

这个没有什么表面是白的啊

基本来说都是这种这个各种各样不同的这种颜色的这种形状怎么样

是不是非常神奇对吧

然后这个所以就给大家介绍一下啊

然后这里呢如果大家去餐馆吃饭

### 01:26:36,33

![01-26-36](tmp/01-26-36.jpg)

有各种各样不同的这种这种高光

使用过程中产生这种划痕

这种划痕关键是肉眼可见的

可以看到中间是有这个这个呃这个彩色的啊

这个我是说真实生活中是一定可以看得到的好吧

ok 那么最后最后最后一个话题啊

### 01:27:02,33

![01-27-02](tmp/01-27-02.jpg)

叫做这个呃程序化生成的这个表面或者说材质或者说外观啊

那么这个程序化生成是什么意思啊

就是说我用一定的方式来指导它的生成

而我不需要真正的去生成它

我可以这个动态的去查询它

### 01:27:21,80

![01-27-21](tmp/01-27-21.jpg)

什么意思呢

### 01:27:22,90

![01-27-22](tmp/01-27-22.jpg)

比如说这里啊

我这个我可以定义各种各样不同的这种花纹

比如这个这个这个花瓶啊

这个花瓶

然后比如说我这个这个花瓶打在地上摔碎了

然后我还可以看到这个花瓶内部它的花纹到底是什么样的对吧

我可以定义一个所谓三维的纹理

但是大家知道这个存储量啊

在三维的情况下瞬间就上去了

我存一张图还行

### 01:27:42,83

![01-27-42](tmp/01-27-42.jpg)

我存一个三维的体积

在各个地方我都存这么细节的东西

那是不可能的

那怎么办呢

我不存

我什么时候需要用

我什么时候去查

就好像我有一个空间中的函数 f x y z 啊

### 01:27:53,26

![01-27-53](tmp/01-27-53.jpg)

然后我给任何 x y z

我立刻可以得到它的 f 值就可以了

那如果有这么一个函数

那就非常好

而答案是事实上就是有的有那么一些函数

这种函数呢就叫做 noise 函数

叫噪声函数

这些函数允许你这个得到一些很神奇的一些 noise

比如说看起来像木头纹理的这个 noise 啊

然后是在空间中的这个我说清楚啊

这个定义在空间中

然后也就是说如果刚才那个木头的纹额纹理里边砍成两半

你可以看到它的切面上长什么样

那就不行对吧

### 01:28:25,16

![01-28-25](tmp/01-28-25.jpg)

那么这个用一些这个三维空间中的噪声函数

### 01:28:28,60

![01-28-28](tmp/01-28-28.jpg)

就可以得到一些这些这些结果

那这个是为什么叫 procedual 呢

### 01:28:32,3

![01-28-32](tmp/01-28-32.jpg)

那就是随用随取的意思啊

就是这么个意思

所以其实翻译成程序化生成也不太合理啊

就是说 procedure 更多的意思就是说我不生成

### 01:28:42,20

![01-28-42](tmp/01-28-42.jpg)

我需要用的时候

我去找就好了好吧

然后这就是这个事情

那么比如说像这个这个游戏里面很多应用的车子上面的这个叫什么

这个秀啊

这些东西就我就可以生成一系列的这种诶

### 01:28:52,43

![01-28-52](tmp/01-28-52.jpg)

### 01:28:55,86

![01-28-55](tmp/01-28-55.jpg)

我生成这些噪声之后呢

我可以这个我可以对这个噪声做一些操作

比如说这些秀肯定是有些地方有

有些地方没有对吧

噪声如果我认为是 00~1 对吧

### 01:29:05,36

![01-29-05](tmp/01-29-05.jpg)

那我就认为比如说这个噪声函数值大于 0.8 的

那我就认为是 e

然后小于 0.8

认为就是零

我把它二值化对吧

对于这个噪声函数我可以做任意的操作

### 01:29:14,86

![01-29-14](tmp/01-29-14.jpg)

这种后期的处理

只要我处理得当

我就可以得到任意的不同的这种效果

那么这个噪声函数呢

这个普遍大家会应用几种啊

### 01:29:23,43

![01-29-23](tmp/01-29-23.jpg)

就目前来说

这个应用最广泛的叫做 pin noise

然后之后还会有各种各样神奇的什么

good bye noise 啊

各种各样不同的这种噪声函数

但它们的共同点就是这样

你不用管它是怎么样得到的

就是说它允许你给任何空间中 xyz

它会返回给你一个值

就这么回事好吧

那么噪声函数非常非常有用

比如生成地形这么复杂的地形

然后这个山上各种各样不同细节都有诶

这个造成函数就可以做

没有问题

水面也是一样

然后这个就是不同的这个位置啊

然后就是有不同的这个高度

像这种水面到底应该是用一种什么样的噪声来说

### 01:30:00,33

![01-30-00](tmp/01-30-00.jpg)

这个都有人研究好吧

然后呢还有这个比如说这个工作台

大家知道这个木头

因为木头各种各样纹理

它肯定是三维的对吧

它肯定生长这个产生的嘛

那么这个 autodesk 他们做了一个这个工作啊

### 01:30:11,23

![01-30-11](tmp/01-30-11.jpg)

然后就是呃可以这个呃生成三维的木头

并且你不用生成

你可以直接去查询这个三维的木头中间的任何一个部分

然后就是说这个木头你可以任意切割

### 01:30:22,13

![01-30-22](tmp/01-30-22.jpg)

它都可以得到内部的这个任何的东西对吧

同样道理它就是控制这个函数

它应该长什么样来模拟这个数的年轮啊

然后书里面各种各样这些传输的这些传导的这个东西叫什么纤维

什么树

我忘了

反正就是说这个他能够把这些真实的这些物理的这些东西啊

和它的这个程序化生成结合在一块儿

可以得到非常非常真实的结果

好吧

那么这里是它的这个一个例子啊

就是说对于这个吉他来说

在这个这上面的这些纹理完全都没有

### 01:30:51,10

![01-30-51](tmp/01-30-51.jpg)

之前经过定义

就是直接去查询这个它产生的这个木头对应的这么一个三维的函数

就可以得到

好吧

也非常厉害啊

那没问题

那这样的话咱们今天这可是说的不少啊

那咱们就说到这儿

### 01:31:04,3

![01-31-04](tmp/01-31-04.jpg)

然后我现在呢我先看看大家有没有什么其他问题啊

好呃呃对有问题也欢迎也欢迎在这个机问啊

嗯我想一想啊

能量集中哦

这应该不是什么问题

好 ok 说有什么高阶的内容之后再讲是吧

那涉及到这个之后的更复杂的这些课

这会有的会有的

然后咱们之前不是说过这个合成安排嘛对吧

咱们之后这个课之后很快会有一个模拟的这个这个课啊

关于模拟仿真的课结束之后回来有可能是暑假

我来给大家说

要么说实时渲染

要么说高级的这个呃也就相当于是要么说高级的今天讲的这些内容

把今天这些这一节课给拓展到这个呃

每一块都讲清楚啊

嗯这是一个

然后有同学问说这个程序化材质是不是老方法

并不是一直都有人研究

到现在还是一个很火的一个话题啊

然后这个好吧好吧

我来看看啊

嗯 procedure 有什么最新的东西哦

最新的东西其实这样说也挺难

这个这个木头这可能算是它是一个挺是怎么说呢

集大成的一个东西了

然后有一个软件是专门做程序化材质的呀

叫 hudi 啊

然后这个在工业界得到了很大的应用

只不过它的程序化材质是真的是先程序化生成

然后你再拿去用啊

是这个意思

它和我们这个理解并不太一样啊

就是我们这个是不用生成

直接去查询啊

ok 然后这个 ok 有同学反映这个没有 ri 老师的贡献

是的

这这次并没有啊

哈哈哈呃没问题啊

好啊

然后另外是这么回事

其实我说这个这个也有其他老师的贡献

特别是对于今天的这个这个嗯这这课件来说啊

绝大部分是我在伯克利的时候

作为助教

我做的那节课也是我讲的

是这么回事啊

就是说这个这个今天拿过来

然后再加了一些新的东西啊

是这么个意思好吧

然后呃波动光学的渲染能讲吗

不能不能真不能啊

这个波动光学讲完要死人的

这个是你们要是感兴趣的话啊

感兴趣的话访问一下我的个人主页

你随便点点一个这个点一个这个我的波动光学的这个文章

你看一眼就行了

你觉得能看下去

我就给你讲怎么样

唉这个这个简直了

prostring 是肯定是这个我们不是说了嘛对吧

然后复杂的光线传播我可以讲没问题啊

好啊

那 ok 那没问题

那这样的话这个这个呃咱们今天就说到这儿啊

然后咱们之后这个这就算是这个呃复杂一点话题

但是就是就是随便听一听啊啊
