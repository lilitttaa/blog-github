---
title: Games101 19.Cameras, Lenses and Light Fields
---

## Imaging

![Alt text](image.png)

- 成像 = 合成 + 捕捉
- 合成：光栅化成像 + 光线追踪成像
- 捕捉：把真实世界中的东西变成照片，有各种成像方法。当然最简单的是用相机。比如还有研究光在极短时间内的传播，就能看到光传播的一个过程（transient imagine），这块主要是叫计算摄影学（computational photography）。

我们从相机开始，相机内部发生了什么呢？
![Alt text](image-1.png)

- 各种部件：镜头、棱镜、机身、感光元件、快门

小孔成像：
![Alt text](image-2.png)

- 只有刚好通过小孔的光线不会被挡住，在后面形成倒立的像。
- 这个原理有真正对应的相机，叫针孔相机。

相机的各个部件：

![Alt text](image-3.png)

- 快门（shutter）：控制光线进入的时间

![Alt text](image-4.png)

- 传感器（sensor）：把光记录下来，或者说也叫成像，记录的是 irradiance

![Alt text](image-5.png)

- 如果没有棱镜，会收到各个方向的光，会糊掉。
- 也有人在研究一些传感器，可以记录不同方向的光，这样就能记录 radiance，而不是 irradiance。

我们来分析一下小孔成像：

![Alt text](image-6.png)
![Alt text](image-7.png)

- 可以用这个小孔来拍照，得到这样的结果
- 针孔相机拍出来的东西是没有景深的，任何地方都是清楚的，不会是虚的。

## Field of View

![Alt text](image-8.png)

- 影响我们能看到多大的范围
- 广角镜头就是 FOV 更大
- 这里就是一个简单的相似三角形的计算。

![Alt text](image-9.png)

- 通常以 35mm 格式的胶片为基准，所以传感器大小是一定的。
- 所以我们用焦距来定义 field of view。
- 比如 17mm 对应广角镜头。
- 比如手机可能就是 28mm，不过需要注意的是手机那么薄肯定没有 28mm 的焦距，这里的焦距是等效焦距，就是相当于 35mm 胶片的焦距。（手机的传感器比较小，所以焦距也小）

下面是不同焦距的镜头拍出来的效果：
![Alt text](image-10.png)

如果我们用不一样的胶片，那么传感器的大小也会不一样：
![Alt text](image-11.png)

- 小一些的传感器对应小的 FOV
- 传感器负责记录最后的 irradiance 有多大
- 每个像素最后的 Film 决定要把它存成什么样的图片格式
  ![Alt text](image-12.png)
  ![Alt text](image-13.png)
- 越大的传感器，分辨率越高
- 所以通常越大的相机越好

## Exposure

曝光到底是什么？

![Alt text](image-14.png)

- 由 irradiance 和 time 决定，曝光的时间越长，光线进入的越多，最后的结果就越亮。
- 除此之外，还有光圈的大小，光圈越大，进入的光线就越多，最后的结果也就越亮。

![Alt text](image-15.png)

- 光圈其实就是一个挡光的东西，它是一个仿生学的设计，仿照人的瞳孔，光线强的时候，瞳孔会缩小，光线弱的时候，瞳孔会放大。由 f-stop 控制。
- 快门，shutter speed 越快，光线进入的时间就越短，最后的结果就越暗。
- iso，感光度，它是一个后期处理，接受到多少光，最后再乘上一个 iso。

![Alt text](image-16.png)

- 5,6 是欧洲写法，其实就是 5.6。这个数越大光圈越小。
- 1/1000 秒就是快门开放的时间，1/1000 秒就是 1ms。
- 光圈用太大，照片看上去就很虚
- 如果人在跑步，快门时间长，就会看到一个模糊的东西
- 信号本身有噪声，如果放大信号，也会放大噪声，这就是为什么 iso 调高会有噪声的原因。
- 可以把光理解为光子，快门时间不够，进到感光元件部分的光子数就少，光子数少造成噪声。

ISO：
![Alt text](image-17.png)
![Alt text](image-18.png)

![Alt text](image-19.png)

- 也就是光圈直径的倒数

![Alt text](image-20.png)

- 快门升上去打开，然后再关上，它并不是一瞬间就打开的，有一个过程。

![Alt text](image-21.png)
![Alt text](image-22.png)

- 如果有个运动的物体，快门打开一段时间，这段时间传感器在不断的记录，所以就会有模糊的现象，这就是运动模糊。
- 其实也就是在时间上采样
  ![Alt text](image-23.png)
- 机械快门打开有个过程，会导致 rolling shutter（超高速运动的东西会造成扭曲）
- 不同的位置记录的是不同的时间，就会出现扭曲的现象

![Alt text](image-24.png)

- 大光圈会引起景深的问题，快门时间会引起运动模糊的问题，这两个事情需要权衡。

![Alt text](image-25.png)

- 高速摄影：快门时间短，要么用大光圈，要么用高 iso。但是高 iso 会有噪声，所以实际还是用大光圈。

![Alt text](image-26.png)

- 延时摄影：快门时间长，用小光圈慢慢拍。

## Lenes

![Alt text](image-27.png)

- 一般都是用棱镜组来成像

![Alt text](image-28.png)

- 实际的棱镜也没法把光聚到一块，会有 aberration（像差）

我们研究的棱镜呢是理想化的薄棱镜：
- 厚度忽略不计
- 能集中光线到焦点

![Alt text](image-29.png)
- 按照光路的可逆性，过焦点的光线会变成平行光。
- 棱镜组通过不同的组合，可以改变焦距。

Gauss’ Ray Diagrams：
![Alt text](image-30.png)
![Alt text](image-31.png)
![Alt text](image-32.png)
![Alt text](image-33.png)

### Defocus Blur

利用薄棱镜可以解释景深问题：
![Alt text](image-34.png)
- 根据前面的公式，$\frac{1}{f} = \frac{1}{z_i} + \frac{1}{z_o}$，我们可以算出成像的位置。
- Sensor 不在这个位置，一个点会被成像成一个圆，这个圆就是 circle of confusion，所以看上去会模糊。
- 公式中$z_s$这个距离是确定的，像距$z_i$是确定的，根据右边两个相似三角形，可以得到这么一个关系。所以发现 circle of confusion 和光圈大小成正比。

![Alt text](image-35.png)

### Revisiting F-Number/F-Stop

![Alt text](image-36.png)
![Alt text](image-37.png)
- 这样F-Number和焦距、光圈大小都关联起来了。

![Alt text](image-38.png)
- 这里的A也就是上边的D，表示光圈的直径。
- F-Number跟Circle of Confusion成反比，所以为了拍摄清晰的照片，我们需要用F-Number大（直径小）的光圈。



### 01:04:06,99

![01-04-06](tmp/01-04-06.jpg)

ok 那么下面一个问题就是这个说这个这个这个棱镜啊

我们之前不是说我们可以给棱镜做一个简单的模型

就是这个薄棱镜对吧

然后我们说光线怎么样穿过它

我们都知道诶

那么光线穿过它

我知道那自然而然我就可以用薄棱镜来渲染啊

那我之前说我们用这个呃

正常的这个这个我们现在做 plication 也好

怎么样也做也好啊

我们都是从这个怎么怎么产生光线

还记得吗

ratiation 我们从这个相机往任何一个像素中心去连这个线

其实就默认了这是小孔

成像的模型对吧

针孔摄像机的模型

但是我们完全可以渲染出这种模型了

### 01:04:45,49

![01-04-45](tmp/01-04-45.jpg)

就是这样的

我们可以模拟这个薄冷静

然后我们可以给它一个这个呃焦距对吧

然后我们可以这个把它给放置的

这个就是说我的这个成像的平面

所谓这个 ser 和这个这个这个镜头有多远

然后实际去做光线追踪

那这个怎么做呢对吧

这个很简单很简单

### 01:05:04,99

![01-05-04](tmp/01-05-04.jpg)

大家来看这么一个例子

其实就完全就可以明白了

那么首先呢我肯定要先定义这个场景

定义场景

我肯定得定义这个棱镜啊

各方面的各种各样的事情

那

所以给大家一种设定方案怎么做呢

首先啊我先确定我的这个 sensor 它本身有一定大小啊

这肯定得定义

这就是我的成像平面嘛对吧

然后它本身在空间中占了多大这么一个区域

然后呢我还定义一个这个呃棱镜本身的属性

棱棱镜的属性呢就是它的这个这个这个呃焦距和它的光圈的大小

没问题吧

我可以定义这些属性

这些属性大家看到和场景都还没关系呢对吧

就是我先把这些成像平面和呃棱镜我都定义起了

这里就没什么所谓 camera position

没那个东西了

没有那个小点了对吧

我把

这个定义下来

那么下面一个呢我定义什么呢

我定义我把这个棱镜啊放的离这个场景中某一个平面有多远好

我就认为好

我这个平面是是我想这个着重我去我去拍摄的

就是这个意思啊

然后就是这一个平面

我认为他这个呃离嗯我的冷静距离也就是物距是 z0

好吧

我把这个棱镜真正的放在了场景上的某个位置

不就说白了就是这个意思吧对吧

那我棱镜属性设置好了

这个 sensor 设置好了

我又把它放在场景中某个位置了

那这样的话根据棱镜公式

我知道这个呃物距的是是 z

零对吧

然后我又知道它的焦距是多少

我自然知道相距是多少对吧

那也就是说这样就知道这个 a sensor 呃

和这个这个这个棱镜的距离是多少的

就是这个 zi 没问题啊

这刚才我们说的这个呃薄棱镜的公式

那这样一来呢

我们就可以实际来做 retracing 对吧

那怎么做呢

很简单啊

### 01:06:46,99

![01-06-46](tmp/01-06-46.jpg)

这么做就是说我我现在不就是想找一些光线

让它穿过棱镜能够打到场景里面去吗

那行那我对于我的三字上面呢

我来找一个这个哎呀

好

问题是这样哈

有同学有同学问这个问题

说这个呃这个棱镜和透镜是不是

一个是不是一个概念

呃好像我一直在在这个混用这个概念哈

呃理论上来说应该是管它叫透镜

而不是把它叫冷静哈

呃棱镜应该是另外一回事

嗯好那行

从现在开始我来改口啊

就是说不管怎么样

我们这节课说的都是这个 length 啊

然后呃就就叫透镜吧

好那没问题

那呃是这样哈

那我在这个成像平面上呃

或者说感光元件上选一个点 x prime 好吧

然后呢我在这个透镜上选另外一个点

就是透镜本身不是薄的透镜嘛对吧

然后我认为他是在这个上面的任何一个一个点上

它本身就不是

一个圆吗

对我在上面选一个点

那这就是第二步好

那么我们选定了这两个点之后

我把这两点连一连一条线

连一条线之后

我就立刻可以知道他会这个往另外一个方向去到哪儿对吧

就为什么我知道呢

是因为这个呃连着这条线啊

它是从这个这个 x a prime 等 x prime prime 对吧

它这个中间他们两个的垂直距离就是相距嘛

那么我知道这个这个光过去了之后

他一定会达到这个 x 这个三点这个这个位置

这是在哪儿

他一定是在这一个哎平面上对吧

这这个不会有问题

然后这就是我们在

用能力公式我们可以知道它会达到这么一个位置上去

那就没问题

那我知道呃

就是说穿过 x prime 和 x 这个 prime prime

然后到这个 triple prime 上面

然后这条光线这是一个什么样的方向

诶

这个是没问题的

可以知道

那我知道这个了之后怎么办呢

那我自然而然我就知道哦

这条这条光线最终会被记录到这个呃 3s 上的呃这么一个点上好啊

这样的话我就只需要考虑这一条线

这个 x double prime 到 triple prime 这条光线上

它带有的 radiance

最后算出来可以寄到这个 x prime 上就可以了

没问题吧

唉也就是说这个呃说

白了其实就是简单利用一下这个棱镜公式去算一算

它这个折射的光线的方向就可以了

好吧那行

那这就没有问题啊

好我们那就进入下面一个这个这个话题啊

### 01:09:09,99

![01-09-09](tmp/01-09-09.jpg)

啊那我说呃下面一个我们就可以用这个 defocus blue 来正式的定义嗯

这个景深这么一个概念好吧

那所谓景深

那咱咱们看这个两张这个照片哈

### 01:09:23,99

![01-09-23](tmp/01-09-23.jpg)

两张照片

然后他用的就是不同的这个光圈大小

用大的光圈和小的光圈没问题吧

那么我就是说啊这个呃我们之前知道大光圈对应大的 c o c

然后得到的就是一个点会变成更大的

一个圆

所以就会更模糊

没错吧

那么但是总归在有一些地方它是不模糊的

那就是在他的这个这个这个呃就是 focal plan 啊对吧

在这个平面上都是不模糊的

那也就是说什么呢

也就是说啊我这个用大光圈和小光圈会影响到什么

会影响到这个模糊的范围对吧

就是说我知道在这些地方它总是不模糊的

但是为什么这个稍微远点它就模糊了对吧

它肯定有一个模糊的范围

然后就是说呢我这个用大小光圈会影响这么一个范围

那咱们现在来研究这么一个范围好吧

这是怎么回事呢

### 01:10:14,49

![01-10-14](tmp/01-10-14.jpg)

咱

们可以看到啊

就是说这个呃有有这个光

然后经过这个透镜透镜

然后它会达到某一个这个成像平面

在这个成像平面的附近一段区域内诶

这个区域内我都认为啊这个 c o c 是足够小的

大家看这里定义就是这么回事

我们怎么定义呢

我们认为景深就是指在这个呃实际的这个场景中

有一段这个深度

这一段登录经过透镜之后

会在这个呃会在这个这个这个呃横向平面的附近形成一段这个区域

这段区域内我认为 coo c 都是足够小的

是这么一个意思

好吧

这样想

那就那就没有

问题好

那呃呃所以说呢那我要算这个景深

其实我就是想算在 c o c 这个呃很小的一段范围内

然后呃我我基本上认为这个对应的那边我看到的这个场景

这一段它是呃就是清洗的诶

为什么我们可以这么理解呢

你可以这样想啊

虽然他不是这么回事

这样想就是说你的成像平面不是有各种各样的像素嘛对吧

一个像素它再怎么说它不是一个点

它是有这个大小的对吧

当这个 c o c 的大小跟像素相比

它只要跟像素差不多或者比像素小

哎我都认为得到的结果最后是锐利的

对吧我可以这么认为

那也就是说这就是为什么说我不止说这个成像平面

自己成像平面附近的一个很微小的范围诶

我都是可以接受

认为这一段成像出来结果都是锐利的啊

这样想就对了

那所以说这个呃所谓景深对应的这一段就是这个 cc 小的这一段好

### 01:11:54,49

![01-11-54](tmp/01-11-54.jpg)

那么咱们来看这么一个这个图哈

这个图看起来非常复杂

其实一点也不复杂

然后大家这个是怎么说呢

我说景深实际上是指这场景中间的某一段深度

然后使得它经过这个棱镜之后到达成像平面附近

在这个范围内

它的 c

o c 都比较小对吧

我们就是这么说的嘛

那我可以考虑这个景深的最远处和最近处呃

最近处我可以让它穿过棱镜呃

呃透镜

然后让它这个到某一个地方对吧

然后最远处穿过透镜

它会到某一个地方

然后这样的话呢我就可以得到这么这么一个范围

然后这个范围它对应 c o c 是多大

我自然也知道好吧

那这些我都可以用各个不同的距离把它给标注出来

这里呢不做推导好吧

这里其实想推导的话超级简单

大家不要看这里量这么多哈

我们到底要干什么

我们要把这个 the field 也

对应了它这些深度

比如说最远的这个深度叫 df 大写 d 啊

和他最近的这个深度叫 dn

以及他在这个这个聚焦的平面上

focal plan 上它的这个深度叫 ds 大写

然后他这个投影过来之后

不要投影过来啊

穿过龙透镜之后

它到这个成像平面附近

它对应的深度

我们希望把这几个深度和这个呃焦距给联系起来啊

就是这么一个事情

那那就是说简单的来说

就是说我们看这边形成的相似三角形就好了啊

然后这里就不再给大家说了

看这个式子大家肯定都会明白

就在这个这个透镜的右边来

进行分析就可以了

然后呢我们知道所谓 depth of field

我们刚才定义了就是某一段深度多少呢

df 减 dn 就是这一段对吧

然后这个深度到底有多少

然后我们就可以解出来啊

非常简单非常简单

真的不要看那么多数啊

### 01:13:38,99

![01-13-38](tmp/01-13-38.jpg)

ok 那么同样道理

这里也有也有一个这个这个例子哈

然后这里给大家看一眼

然后啊这是什么意思呢

### 01:13:45,99

![01-13-45](tmp/01-13-45.jpg)

就是说大家可以看到这边啊

从这个点到这个点

那这就是我认为这就是呃 det field 没问题

然后呢那我可以调一调

比如说诶我可以调一调这个呃我这个不同的这个深度

假如

说我要呃我要看怎么说呢

就是说我的 depth of field 在变化对吧

然后这边就是我的这个 sensor

对应的就是 sensor 离这个呃透镜的距离在变化诶

我可以看到这个 s 离这个呃透镜距离近的时候

然后对应 deft field 就变大诶

然后这个离太远的时候

deft field 变小

当然了

然后还有一些这个这个其他的各种性质

比如说最简单的性质

如果我改变 focal length 对吧

就是说这个改焦距的时候会有这么一个会有这么一个这个现象对吧

然后这个如果我用这个大的焦距

我就会看到更浅的这个 david 也就看到了这个就是只

有一小段是不模糊的

其他地方都是模糊的对吧

那如果说我要改这个 f number

f number 是什么

还记得吧

就是改这个棱镜不是透镜的大小呗

就是光圈的大小呗

光圈改光圈大小的时候

我会发现也有这么一个性质啊

改光圈大小的时候

我会发现这个光圈越小

然后我发现景深越大

这个是非常能解释问题的

就是光圈越小嘛

我这个嗯透镜就越接近这个小孔对吧

接近小孔的话

在各处都应该是这个清晰的

那也就意味着它的这个 depth of field 就是清晰的范围会大

有问题啊

那所以说通过这个大

家就可以这个呃去分析这个事情

以及说我们还可以这个做另外一个实验

就是诶这里把它调回来

比如说我们可以调这个 confusion

如果我对这个 circle of confusion 的大小

这个呃做一些限制

我认为哈就这么大的时候我还能接受对吧

我还觉得这个时候这个呃各处城像这些东西都是清晰的

那我自然而然对应更大的 circle of computer

得到的这个景深就越越就越深

就是这个意思好吧行

那这回这个这块景深这块就说明白了

### 01:15:48,49

![01-15-48](tmp/01-15-48.jpg)

景深就是指这个成像清晰的一段范围啊

这个意思行

### 01:15:53,49

![01-15-53](tmp/01-15-53.jpg)

那么我觉得今天应该是没时

间来这个继续讲广场和这个所谓 loomy graph 这个事情了哈

然后广场咱们留到下一节课开始再给大家说吧

虽然颜色这块也有很多的内容哈

就是颜色这块涉及到感知

可能来说比这节课还要相对来说难以理解一些

为什么呢

因为这节课毕竟如果大家这个呃推导工作没有做过

没关系

大家这个照相照得多

对这块理解肯定是没有问题的

那么下节课讲颜色与感知的时候

有很多事情是违背常理的

然后所以说我们嗯下节课再好好把这个话题说一说

在争取把这个呃广场再继续往后呃

看看吧

如果有时间就讲

没时间算了好吧

那那咱们今天这个哦好吧

有同学反应说让讲完

今天就不讲完了

今天不讲完了

实在是不敢再拖堂了

那么嗯这这边是这样啊

我之前给大家解释过一小时 15 分钟

这是正常时间啊

我原本之前这个课正常的课时时间就是一小时 15 分钟

然后呃那行没问题

那今天我们说到这儿

然后如果大家有问题的话

欢迎呃这个这个呃现在来呃

这个

发弹幕啊

然后我现在关注一下

然后如果没有的话

其实现代摄影入门啊是是这么回事

就是说我们这个这个图形学嘛

这肯定是得把这个呃这个这个相机这块儿给讲讲明白对吧

就是说相机这里面涉及到各种各样的公式

但推起来真的不难

就是就是这么个意思

就是咱们把各个这个不同的这些功能

各种不同的组件

它到底是什么意思

说明白就好

在这里给大家道歉哈

这个是确实它应该叫透镜

不应该叫棱镜啊

这是真是糟糕

我想当然哈啊

ok 那没问题啊

如果有同学在反应

希望想多了解广场的话

我想想办法多说一点吧

但其实从图形学的角度上来说

不涉及具体项目

广场本身挺好定义的

这个并不难哈

那那行没问题

有同学反映啊

曝光补偿和曝光时间

光圈大小有什么关系诶

咱们之前不是这个说了吗

放在这个 slides 里面

三个的不同影响吧对吧

就是三个不同因素呃

然后 f stop 是光圈大小

也是透镜大小

这可以这么理解

可以这么理解

就实际上来说你是通过不同的东西去去挡这个透镜哈

然后你就可以理解成我是在动态的改这个透镜的大小

这是可以这么理解的啊

没什么问题

对啊 ok 啊

这公式现在还有用吗

有啊有啊

就是就是现在来说

虽然大家用这个呃薄冷呃

薄透镜哈

用的这个这个比较多

但实际上来说在生产制中间各种各样这个透镜组对吧

然后然后这些设计肯定还都要用到这些公式

然后他们还有各种各样复杂的这些呃不讲就不只是这个凸透镜

还有这种凹透镜

还有一面是平的

这种凹透镜都会放在一块儿

这就是我说为什么组合在一块儿可以去动态的改变

改变它的这个呃焦距啊

是这么个意思

好吧嗯成像位置和焦点的关系是怎么理解

这个其实完全不是一回事啊

就是说这个嗯对吧

丞相嗯就这样想吧

就是相当于满足这个呃嗯满足这个透镜公式的这个这样一些配置

就是说呃在物距是某一个距离的情况下

然后如果焦距是某一个距离

你可以算出来一个相距

如果你正好把成像平面放

那那就是说你正好可以看到那个在物距那么长的这个这个距离的呃

那个平面它的清晰的投影投到这个呃这个感光的这个这个胶片上

所以说嗯应该是这两个之间没有什么关系

是一个实际的一个一个这个位置和一个这个就是焦点的这么一个位置

就是说焦点它唯一的它的性质就是说这个过焦点会变平行

平行的会过焦点是这么个意思

它和实际的没关系

理解就理解成这个呃透镜左边画一个三角形

右边再画另外一个三角形

就这么理解对了

好吧啊好嗯

今天讲的和视锥这个关系有

但是这个比较复杂

这我就不得不再多说了好吧

那 ok 那要不咱们今天讲到这儿好吧

ok 那行
